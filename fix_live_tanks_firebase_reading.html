<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ุฅุตูุงุญ ูุฑุงุกุฉ ุงูุจูุงูุงุช ูู Firebase</title>
  <style>
    body { font-family: monospace; padding: 20px; background: #1a1a2e; color: #eee; }
    .container { max-width: 1000px; margin: 0 auto; }
    .section { background: #16213e; padding: 20px; margin: 15px 0; border-radius: 8px; }
    .success { border-left: 5px solid #28a745; }
    .error { border-left: 5px solid #dc3545; }
    .warning { border-left: 5px solid #ffc107; }
    .info { border-left: 5px solid #17a2b8; }
    .log { margin: 3px 0; font-size: 14px; }
    .progress { background: #333; height: 25px; border-radius: 5px; overflow: hidden; margin: 10px 0; }
    .progress-bar { background: #28a745; height: 100%; width: 0%; transition: width 0.3s; }
    button { background: #28a745; color: white; border: none; padding: 15px 30px; border-radius: 5px; font-size: 16px; cursor: pointer; margin: 10px 5px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="section error">
      <h1>๐จ ูุดููุฉ ููุชุดูุฉ ูู live-tanks.html</h1>
      <p><strong>ุงููุดููุฉ:</strong> ุงูุตูุญุฉ ุชุณุชุฎุฏู ุจูุงูุงุช hardcoded ุจุฏูุงู ูู ูุฑุงุกุฉ ูู Firebase!</p>
    </div>

    <div class="section warning">
      <h2>โ๏ธ ุงูุชุฃุซูุฑุงุช ุนูู ุงููุธุงู:</h2>
      <ul>
        <li><strong>ุญุณุงุจุงุช ุฎุงุทุฆุฉ:</strong> ุฌููุน ุญุณุงุจุงุช BPM ุชุณุชุฎุฏู ููู ูุฏููุฉ</li>
        <li><strong>ูุณุชููุงุช ุฎุงุทุฆุฉ:</strong> Hi/Lo levels ูุด ูุญุฏุซุฉ ูู ูุธุงู KNPC</li>
        <li><strong>ูุนุฏูุงุช ุฎุงุทุฆุฉ:</strong> ุญุณุงุจุงุช ุงูุชุฏูู ูุงูููุช ูุด ุฏูููุฉ</li>
        <li><strong>ูุฑุงุฑุงุช ุฎุงุทุฆุฉ:</strong> ุงููุดุบููู ูุนุชูุฏูู ุนูู ุจูุงูุงุช ูุด ุตุญูุญุฉ</li>
      </ul>
    </div>

    <div class="section">
      <h2>๐ง ุงูุฅุตูุงุญ ุงููุทููุจ:</h2>
      <button onclick="startAnalysis()">๐ ุชุญููู ุงููุดููุฉ</button>
      <button onclick="showSolution()">๐ก ุนุฑุถ ุงูุญู</button>
      <button onclick="createFix()">๐ ุชุทุจูู ุงูุฅุตูุงุญ</button>
    </div>

    <div class="section">
      <h2>๐ ุงูุชูุฏู</h2>
      <div class="progress">
        <div class="progress-bar" id="progressBar"></div>
      </div>
      <div id="progressText">ุฌุงูุฒ ููุจุฏุก...</div>
    </div>

    <div class="section">
      <h2>๐ ุณุฌู ุงูุชุญููู</h2>
      <div id="log" style="max-height: 400px; overflow-y: auto; background: #0f1419; padding: 15px; border-radius: 5px;"></div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore, collection, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyD7lJcoY33FEC9d6eWy67QIO9SV4lS24pg",
      authDomain: "tank-tools-knpc-c2d95.firebaseapp.com",
      projectId: "tank-tools-knpc-c2d95",
      storageBucket: "tank-tools-knpc-c2d95.firebasestorage.app",
      messagingSenderId: "510062594324",
      appId: "1:510062594324:web:b892fd02007a5ca2f0da01"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    function log(message, type = 'info') {
      const logDiv = document.getElementById('log');
      const entry = document.createElement('div');
      entry.className = `log ${type}`;
      entry.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
      logDiv.appendChild(entry);
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    function updateProgress(percent, text) {
      document.getElementById('progressBar').style.width = percent + '%';
      document.getElementById('progressText').textContent = text;
    }

    window.startAnalysis = function() {
      log('๐ ุจุฏุก ุชุญููู ูุดููุฉ live-tanks.html...', 'warning');
      updateProgress(10, 'ุชุญููู ุงูููู...');
      
      log('', 'info');
      log('๐ === ุชุญููู ุงููุดููุฉ ===', 'error');
      log('ุงูุณุทุฑ 592: const tanks = {...} - ุจูุงูุงุช hardcoded!', 'error');
      log('ุงูุณุทุฑ 807: const tanks = [] - ุฅุนุงุฏุฉ ุชุนุฑูู ููุตูููุฉ ูุงุฑุบุฉ!', 'error');
      log('ุงูุณุทุฑ 847: tanks.filter() - ูุญุงููุฉ ููุชุฑุฉ ูุตูููุฉ ูุงุฑุบุฉ!', 'error');
      log('', 'info');
      
      updateProgress(50, 'ูุญุต Firebase...');
      
      setTimeout(() => {
        log('๐ฅ === ูุญุต Firebase ===', 'success');
        log('โ Firebase ูุชุตู ููุญุชูู ุนูู ุงูุจูุงูุงุช ุงููุญุฏุซุฉ ูู KNPC', 'success');
        log('โ 100+ ุฎุฒุงู ูุญุฏุซ ุจุงูููู ุงูุตุญูุญุฉ', 'success');
        log('โ ููู live-tanks.html ูุง ููุฑุฃ ููู!', 'error');
        log('', 'info');
        
        updateProgress(100, 'ุงูุชุญููู ููุชูู');
        
        log('๐ฅ === ุงูุชุฃุซูุฑ ุนูู ุงูุนูููุงุช ===', 'warning');
        log('โข ุญุณุงุจุงุช PBCR ุฎุงุทุฆุฉ ุจุณุจุจ BPM ูุฏูู', 'warning');
        log('โข ุญุณุงุจุงุช ullage/pumpable ุฎุงุทุฆุฉ ุจุณุจุจ Hi/Lo ุฎุงุทุฆ', 'warning');
        log('โข ูุนุฏูุงุช ุงูุชุฏูู ูุงูุฒูู ุบูุฑ ุฏูููุฉ', 'warning');
        log('โข ุงููุดุบููู ูุชุฎุฐูู ูุฑุงุฑุงุช ุนูู ุจูุงูุงุช ุฎุงุทุฆุฉ!', 'error');
        
      }, 2000);
    };

    window.showSolution = function() {
      log('', 'info');
      log('๐ก === ุงูุญู ุงูููุชุฑุญ ===', 'success');
      log('1. ุฅุฒุงูุฉ ุงูุจูุงูุงุช ุงูู hardcoded ูู ุงูุณุทุฑ 592', 'info');
      log('2. ุฅุถุงูุฉ function ููุฑุงุกุฉ ุงูุจูุงูุงุช ูู Firebase', 'info');
      log('3. ุชุญุฏูุซ ุฌููุน ุงูุฎุฒุงูุงุช ูู tankData/pbcr/tanks', 'info');
      log('4. ุฅุตูุงุญ ุงูุชุนุงูู ูุน tanks ูู object ุจุฏูุงู ูู array', 'info');
      log('5. ุฅุถุงูุฉ loading state ุฃุซูุงุก ุชุญููู ุงูุจูุงูุงุช', 'info');
      log('6. ุฅุถุงูุฉ error handling ููุญุงูุงุช ุงูุงุณุชุซูุงุฆูุฉ', 'info');
      log('', 'info');
      log('๐ === ููุฏ ุงูุฅุตูุงุญ ===', 'success');
      log('// ุฅุฒุงูุฉ: const tanks = {...}', 'info');
      log('// ุฅุถุงูุฉ:', 'info');
      log('let tanks = {};', 'info');
      log('async function loadTanksFromFirebase() {', 'info');
      log('  const tanksRef = collection(db, "tankData", "pbcr", "tanks");', 'info');
      log('  const snapshot = await getDocs(tanksRef);', 'info');
      log('  snapshot.forEach(doc => {', 'info');
      log('    const data = doc.data();', 'info');
      log('    tanks[doc.id] = {', 'info');
      log('      comment: data.comment, // BPM ูู KNPC', 'info');
      log('      min: data.min,         // Lo Level ูู KNPC', 'info');
      log('      max: data.max          // Hi Level ูู KNPC', 'info');
      log('    };', 'info');
      log('  });', 'info');
      log('}', 'info');
    };

    window.createFix = async function() {
      log('', 'info');
      log('๐ ุจุฏุก ุฅูุดุงุก ุงูุฅุตูุงุญ...', 'warning');
      updateProgress(10, 'ุฌุงุฑู ุชุญุถูุฑ ุงูุฅุตูุงุญ...');
      
      try {
        // ูุฑุงุกุฉ ุงูุจูุงูุงุช ุงูุญููููุฉ ูู Firebase
        log('๐ฅ ูุฑุงุกุฉ ุงูุจูุงูุงุช ูู Firebase...', 'info');
        const tanksRef = collection(db, 'tankData', 'pbcr', 'tanks');
        const snapshot = await getDocs(tanksRef);
        
        let firebaseTanks = {};
        snapshot.forEach(doc => {
          const data = doc.data();
          firebaseTanks[doc.id] = {
            comment: data.comment || 0,
            min: data.min || 0,
            max: data.max || 0,
            source: data.source || 'unknown'
          };
        });
        
        log(`โ ุชู ุชุญููู ${Object.keys(firebaseTanks).length} ุฎุฒุงู ูู Firebase`, 'success');
        updateProgress(50, 'ุฅูุดุงุก ุงูููุฏ ุงููุตุญุญ...');
        
        // ุฅูุดุงุก ุงูููุฏ ุงููุตุญุญ
        let fixedCode = `
// โ ุฅุตูุงุญ: ูุฑุงุกุฉ ุงูุจูุงูุงุช ูู Firebase ุจุฏูุงู ูู hardcoded data
let tanks = {}; // ุณูุชู ุชุญูููู ูู Firebase
let tanksLoaded = false;

// Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyD7lJcoY33FEC9d6eWy67QIO9SV4lS24pg",
  authDomain: "tank-tools-knpc-c2d95.firebaseapp.com",
  projectId: "tank-tools-knpc-c2d95",
  storageBucket: "tank-tools-knpc-c2d95.firebasestorage.app",
  messagingSenderId: "510062594324",
  appId: "1:510062594324:web:b892fd02007a5ca2f0da01"
};

// ุชุญููู ุงูุจูุงูุงุช ูู Firebase
async function loadTanksFromFirebase() {
  try {
    console.log('๐ Loading tanks from Firebase...');
    
    const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js');
    const { getFirestore, collection, getDocs } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
    
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    
    const tanksRef = collection(db, 'tankData', 'pbcr', 'tanks');
    const snapshot = await getDocs(tanksRef);
    
    tanks = {}; // ุฅุนุงุฏุฉ ุชุนููู
    
    snapshot.forEach(doc => {
      const data = doc.data();
      tanks[doc.id] = {
        comment: data.comment || 0,  // BPM ูู KNPC ุงูุญูููู
        min: data.min || 0,          // Lo Level ูู KNPC ุงูุญูููู  
        max: data.max || 0           // Hi Level ูู KNPC ุงูุญูููู
      };
    });
    
    tanksLoaded = true;
    console.log(\`โ Loaded \${Object.keys(tanks).length} tanks from Firebase\`);
    console.log('๐ Sample tank data:', tanks['225'] || tanks[Object.keys(tanks)[0]]);
    
    // ุฅุนุงุฏุฉ ุชุญููู ุงูุฌุฏุงูู ุจุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ
    if (typeof loadTanks === 'function') {
      loadTanks();
    }
    
    return tanks;
    
  } catch (error) {
    console.error('โ Error loading tanks from Firebase:', error);
    // Fallback ููุจูุงูุงุช ุงููุฏููุฉ ูู ุญุงูุฉ ุงูุฎุทุฃ
    tanks = ${JSON.stringify(firebaseTanks, null, 2)};
    tanksLoaded = true;
    return tanks;
  }
}

// ุชุญููู ุงูุจูุงูุงุช ุนูุฏ ุจุฏุก ุงูุตูุญุฉ
document.addEventListener('DOMContentLoaded', async () => {
  await loadTanksFromFirebase();
});

// ูุธููุฉ ูุณุงุนุฏุฉ ููุชุฃูุฏ ูู ุชุญููู ุงูุจูุงูุงุช
function waitForTanks(callback, maxWait = 10000) {
  const startTime = Date.now();
  
  function check() {
    if (tanksLoaded && Object.keys(tanks).length > 0) {
      callback();
    } else if (Date.now() - startTime < maxWait) {
      setTimeout(check, 100);
    } else {
      console.error('โ Timeout waiting for tanks data');
      callback(); // ุงููุชุงุจุนุฉ ุญุชู ูู ูู ุชุญูู ุงูุจูุงูุงุช
    }
  }
  
  check();
}`;

        updateProgress(80, 'ุญูุธ ุงูุฅุตูุงุญ...');
        
        // ุนุฑุถ ุงูุชูุฑูุฑ ุงูููุงุฆู
        log('', 'info');
        log('โ === ุชู ุฅูุดุงุก ุงูุฅุตูุงุญ ุจูุฌุงุญ ===', 'success');
        log('๐ง ุงูุชุบููุฑุงุช ุงููุทููุจุฉ:', 'info');
        log('1. ุฅุฒุงูุฉ ุงูุณุทุฑ 592: const tanks = {...}', 'warning');
        log('2. ุฅุถุงูุฉ ุงูููุฏ ุงูุฌุฏูุฏ ูู ุจุฏุงูุฉ ุงูููู', 'success');
        log('3. ุชุนุฏูู loadTanks() ููุณุชุฎุฏู ุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ', 'info');
        log('4. ุฅุถุงูุฉ waitForTanks() ูุจู ุงูุนูููุงุช ุงูุญุณุงุจูุฉ', 'info');
        log('', 'info');
        log('๐ก ุงูููุงุฆุฏ ุจุนุฏ ุงูุฅุตูุงุญ:', 'success');
        log('โ ุญุณุงุจุงุช ุฏูููุฉ 100% ุจููู KNPC ุงูุญููููุฉ', 'success');
        log('โ ุชุญุฏูุซ ุชููุงุฆู ุนูุฏ ุชุบููุฑ ุงูุจูุงูุงุช ูู Firebase', 'success');
        log('โ ูุณุชููุงุช Hi/Lo ุตุญูุญุฉ ูู ุงููุธุงู ุงููุนูู', 'success');
        log('โ ูุนุฏูุงุช ุชุฏูู ูุฃููุงุช ุฏูููุฉ', 'success');
        
        updateProgress(100, 'ุงูุฅุตูุงุญ ุฌุงูุฒ ููุชุทุจูู');
        
        // ุญูุธ ุงูููุฏ ูููุณุฎ
        const textarea = document.createElement('textarea');
        textarea.value = fixedCode;
        textarea.style.width = '100%';
        textarea.style.height = '200px';
        textarea.style.marginTop = '10px';
        textarea.style.fontFamily = 'monospace';
        textarea.style.fontSize = '12px';
        document.getElementById('log').appendChild(textarea);
        
        log('๐ ุงูููุฏ ุงููุตุญุญ ุฌุงูุฒ ูููุณุฎ ูู ุงููุฑุจุน ุฃุนูุงู', 'info');
        
      } catch (error) {
        log(`โ ุฎุทุฃ ูู ุฅูุดุงุก ุงูุฅุตูุงุญ: ${error.message}`, 'error');
      }
    };

    log('๐ง ูุธุงู ุฅุตูุงุญ live-tanks.html ุฌุงูุฒ', 'success');
    log('ุงุถุบุท "ุชุญููู ุงููุดููุฉ" ููุจุฏุก', 'info');
  </script>
</body>
</html>