<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø¥ØµÙ„Ø§Ø­ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù€ Rate - Live Tanks</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            color: white;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #FFD700;
            font-size: 2rem;
        }
        .test-section {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border-left: 4px solid #007AFF;
        }
        .section-title {
            font-weight: bold;
            font-size: 1.2rem;
            color: #007AFF;
            margin-bottom: 15px;
        }
        .form-group {
            margin: 15px 0;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #FFD700;
        }
        input, select {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-size: 16px;
            box-sizing: border-box;
        }
        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px 0;
            transition: all 0.3s ease;
        }
        .btn-test {
            background: linear-gradient(45deg, #007AFF, #5856D6);
            color: white;
        }
        .btn-fix {
            background: linear-gradient(45deg, #34C759, #30B845);
            color: white;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        .results {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border: 2px solid rgba(255, 215, 0, 0.3);
        }
        .result-item {
            margin: 10px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            font-family: 'Courier New', monospace;
        }
        .success {
            border-left: 4px solid #34C759;
        }
        .error {
            border-left: 4px solid #FF3B30;
        }
        .warning {
            border-left: 4px solid #FF9500;
        }
        .info {
            border-left: 4px solid #007AFF;
        }
        .path-info {
            background: rgba(255, 152, 0, 0.1);
            border: 1px solid rgba(255, 152, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }
        .data-preview {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .calculation-details {
            background: rgba(52, 199, 89, 0.1);
            border: 1px solid rgba(52, 199, 89, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }
        .rate-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 15px 0;
        }
        .rate-box {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        .rate-old {
            border: 2px solid #FF3B30;
        }
        .rate-new {
            border: 2px solid #34C759;
        }
        .rate-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø¥ØµÙ„Ø§Ø­ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù€ Rate ÙÙŠ Live Tanks</h1>
        
        <div class="path-info">
            <h3>ğŸ“‹ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø§Ø®ØªØ¨Ø§Ø±Ù‡:</h3>
            <p><strong>ğŸ”§ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</strong> calculateActualRate() ÙŠØ·Ù„Ø¹ ØµÙØ± Ù„Ù…Ø§ Ù†Ø¹Ø¯Ù„ Current Level</p>
            <p><strong>ğŸ¯ Ø§Ù„Ø³Ø¨Ø¨:</strong> Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† tankData ÙÙŠ Ù…ÙƒØ§Ù† Ø®Ø§Ø·Ø¦ ÙÙŠ Firebase</p>
            <p><strong>âœ… Ø§Ù„Ø­Ù„:</strong> Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù€ Firebase paths Ø§Ù„ØµØ­ÙŠØ­Ø© Ø­Ø³Ø¨ Rate Unit</p>
        </div>

        <div class="test-section">
            <div class="section-title">ğŸ” Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</div>
            
            <div class="form-group">
                <label>ğŸ·ï¸ Ø±Ù‚Ù… Ø§Ù„Ø®Ø²Ø§Ù†:</label>
                <select id="testTankNumber">
                    <option value="221">Tank 221</option>
                    <option value="460">Tank 460</option>
                    <option value="462">Tank 462</option>
                    <option value="834">Tank 834</option>
                    <option value="833">Tank 833</option>
                    <option value="520">Tank 520</option>
                    <option value="521">Tank 521</option>
                </select>
            </div>

            <div class="form-group">
                <label>ğŸ“Š Rate Unit:</label>
                <select id="testRateUnit">
                    <option value="meter/hr">meter/hr (PBCR Path)</option>
                    <option value="bbl/hr">bbl/hr (PBCR Path)</option>
                    <option value="mÂ³/hr">mÂ³/hr (PBCR Path)</option>
                    <option value="MT/hr">MT/hr (PLCR Path)</option>
                </select>
            </div>

            <div class="form-group">
                <label>ğŸ“ Current Level:</label>
                <input type="number" id="testCurrentLevel" value="10.5" step="0.1">
            </div>

            <div class="form-group">
                <label>ğŸ“ Previous Level:</label>
                <input type="number" id="testPreviousLevel" value="8.2" step="0.1">
            </div>

            <div class="form-group">
                <label>â° Time Difference (hours):</label>
                <input type="number" id="testTimeDiff" value="2" step="0.1">
            </div>

            <button class="btn btn-test" onclick="testCurrentMethod()">
                ğŸ” Ø§Ø®ØªØ¨Ø± Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Ø§Ù„Ù…Ø¹Ø·Ù„Ø©)
            </button>
            
            <button class="btn btn-fix" onclick="testFixedMethod()">
                âœ… Ø§Ø®ØªØ¨Ø± Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…ÙØµÙ„Ø­Ø©
            </button>
        </div>

        <div class="test-section">
            <div class="section-title">ğŸ“Š Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</div>
            <div id="testResults" class="results">
                <p>Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø£Ø¹Ù„Ø§Ù‡ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...</p>
            </div>
        </div>

        <div class="test-section">
            <div class="section-title">ğŸ“ Ø¨ÙŠØ§Ù†Ø§Øª Firebase Ø§Ù„Ù…ÙØ³ØªØ±Ø¬Ø¹Ø©</div>
            <div id="firebaseData" class="data-preview">
                Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‡Ù†Ø§...
            </div>
        </div>

        <div class="test-section">
            <div class="section-title">ğŸ”¢ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</div>
            <div id="calculationDetails" class="calculation-details">
                Ø³ØªØ¸Ù‡Ø± ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ù‡Ù†Ø§...
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, getDocs, doc, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Firebase config (same as tank-management.html)
        const firebaseConfig = {
            apiKey: "AIzaSyBCdv37V6vOFMe42rGlPyl9lVq-9JldEPg",
            authDomain: "tank-tools-knpc-c2d95.firebaseapp.com",
            projectId: "tank-tools-knpc-c2d95",
            storageBucket: "tank-tools-knpc-c2d95.appspot.com",
            messagingSenderId: "678793823159",
            appId: "1:678793823159:web:7a7b1398aefdb7f24462b9"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        // Make available globally
        window.db = db;
        window.getDocs = getDocs;
        window.getDoc = getDoc;
        window.collection = collection;
        window.doc = doc;

        console.log('âœ… Firebase initialized for Rate calculation testing');
    </script>

    <script>
        let currentTestResults = {};

        // Test current (broken) method
        async function testCurrentMethod() {
            const tankNumber = document.getElementById('testTankNumber').value;
            const rateUnit = document.getElementById('testRateUnit').value;
            const currentLevel = parseFloat(document.getElementById('testCurrentLevel').value);
            const previousLevel = parseFloat(document.getElementById('testPreviousLevel').value);
            const timeDiffHours = parseFloat(document.getElementById('testTimeDiff').value);

            displayResults('ğŸ”„ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Ø§Ù„Ù…Ø¹Ø·Ù„Ø©)...');
            clearData();

            try {
                // Simulate current broken method - searching in wrong place
                const testResults = [];
                
                testResults.push({
                    test: 'Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©',
                    result: `Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Tank ${tankNumber} ÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ø®Ø§Ø·Ø¦: tanks[${tankNumber}]`,
                    status: 'warning'
                });

                // Try to load from the OLD way (which fails)
                let tankData = null;
                let foundInOldWay = false;

                // This simulates the OLD broken method from live-tanks.html
                try {
                    // The old method would try to access tanks[tankNumber] directly
                    // which doesn't work because it's not structured properly
                    
                    testResults.push({
                        test: 'Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ø®Ø§Ø·Ø¦',
                        result: 'âŒ tanks[tankNumber] ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ - Ù‡Ø°Ø§ Ø³Ø¨Ø¨ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©!',
                        status: 'error'
                    });

                    // Calculate with no data (results in 0)
                    const levelDiff = Math.abs(currentLevel - previousLevel);
                    let actualRate = 0;

                    if (rateUnit === 'meter/hr') {
                        actualRate = levelDiff / timeDiffHours;
                        testResults.push({
                            test: 'Ø­Ø³Ø§Ø¨ meter/hr Ø¨Ø¯ÙˆÙ† BPM',
                            result: `${levelDiff} m Ã· ${timeDiffHours} hr = ${actualRate.toFixed(2)} m/hr`,
                            status: 'success'
                        });
                    } else {
                        testResults.push({
                            test: `Ø­Ø³Ø§Ø¨ ${rateUnit}`,
                            result: `âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø­Ø³Ø§Ø¨ - BPM ØºÙŠØ± Ù…ØªØ§Ø­ (tankData = null)`,
                            status: 'error'
                        });
                        actualRate = 0;
                    }

                    testResults.push({
                        test: 'Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©',
                        result: `Rate = ${actualRate.toFixed(2)} ${rateUnit}`,
                        status: actualRate > 0 ? 'success' : 'error'
                    });

                } catch (error) {
                    testResults.push({
                        test: 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©',
                        result: `âŒ ${error.message}`,
                        status: 'error'
                    });
                }

                displayResults(testResults, 'current');
                displayData('Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: Ù„Ø§ ØªØ¬Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'current');
                displayCalculations({
                    method: 'current',
                    tankNumber,
                    rateUnit,
                    tankData: null,
                    rate: rateUnit === 'meter/hr' ? (Math.abs(currentLevel - previousLevel) / timeDiffHours) : 0,
                    error: 'Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…ØªØ§Ø­Ø©'
                });

            } catch (error) {
                displayResults([{
                    test: 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±',
                    result: `âŒ ${error.message}`,
                    status: 'error'
                }], 'current');
            }
        }

        // Test fixed method
        async function testFixedMethod() {
            const tankNumber = document.getElementById('testTankNumber').value;
            const rateUnit = document.getElementById('testRateUnit').value;
            const currentLevel = parseFloat(document.getElementById('testCurrentLevel').value);
            const previousLevel = parseFloat(document.getElementById('testPreviousLevel').value);
            const timeDiffHours = parseFloat(document.getElementById('testTimeDiff').value);

            displayResults('ğŸ”„ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…ÙØµÙ„Ø­Ø©...');
            clearData();

            try {
                const testResults = [];
                
                // Step 1: Determine correct Firebase path based on Rate Unit
                let firebasePath = '';
                let department = '';
                
                if (rateUnit === 'MT/hr') {
                    firebasePath = 'tankData/plcr/tanks';
                    department = 'plcr';
                } else {
                    firebasePath = 'tankData/pbcr/tanks';
                    department = 'pbcr';
                }

                testResults.push({
                    test: 'ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ØµØ­ÙŠØ­',
                    result: `Rate Unit: ${rateUnit} â†’ Path: ${firebasePath}`,
                    status: 'info'
                });

                // Step 2: Load tank data from correct Firebase path
                let tankData = null;
                let allTanksInPath = {};

                try {
                    const tanksCollectionRef = window.collection(window.db, 'tankData', department, 'tanks');
                    const querySnapshot = await window.getDocs(tanksCollectionRef);
                    
                    querySnapshot.forEach((doc) => {
                        allTanksInPath[doc.id] = doc.data();
                    });

                    tankData = allTanksInPath[tankNumber];

                    testResults.push({
                        test: 'Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase',
                        result: `ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${Object.keys(allTanksInPath).length} Ø®Ø²Ø§Ù† ÙÙŠ ${department}`,
                        status: 'success'
                    });

                    if (tankData) {
                        testResults.push({
                            test: 'ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø®Ø²Ø§Ù† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨',
                            result: `âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Tank ${tankNumber} ÙÙŠ ${department.toUpperCase()}`,
                            status: 'success'
                        });
                    } else {
                        testResults.push({
                            test: 'ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø®Ø²Ø§Ù† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨',
                            result: `âŒ Tank ${tankNumber} ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ ${department.toUpperCase()}`,
                            status: 'error'
                        });
                    }

                } catch (error) {
                    testResults.push({
                        test: 'Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Firebase',
                        result: `âŒ ${error.message}`,
                        status: 'error'
                    });
                }

                // Step 3: Calculate rate using correct method
                const levelDiff = Math.abs(currentLevel - previousLevel);
                let actualRate = 0;
                let calculationDetails = '';

                if (rateUnit === 'meter/hr') {
                    // Direct calculation - no BPM needed
                    actualRate = levelDiff / timeDiffHours;
                    calculationDetails = `${levelDiff} m Ã· ${timeDiffHours} hr = ${actualRate.toFixed(2)} m/hr`;
                    
                    testResults.push({
                        test: 'Ø­Ø³Ø§Ø¨ Rate (meter/hr)',
                        result: `âœ… ${calculationDetails}`,
                        status: 'success'
                    });

                } else if (tankData) {
                    // BPM-based calculations
                    const bpm = parseFloat(tankData.comment) || parseFloat(tankData.factor) || 0;
                    
                    if (bpm > 0) {
                        const volumeDiffBarrels = levelDiff * bpm;
                        let finalRate = volumeDiffBarrels / timeDiffHours;
                        
                        if (rateUnit === 'mÂ³/hr') {
                            finalRate = finalRate * 0.159; // Convert to mÂ³
                            calculationDetails = `(${levelDiff} m Ã— ${bpm} BPM Ã· ${timeDiffHours} hr) Ã— 0.159 = ${finalRate.toFixed(2)} mÂ³/hr`;
                        } else if (rateUnit === 'MT/hr') {
                            finalRate = finalRate * 0.159 * 0.85; // Convert to MT
                            calculationDetails = `(${levelDiff} m Ã— ${bpm} BPM Ã· ${timeDiffHours} hr) Ã— 0.159 Ã— 0.85 = ${finalRate.toFixed(2)} MT/hr`;
                        } else {
                            calculationDetails = `(${levelDiff} m Ã— ${bpm} BPM) Ã· ${timeDiffHours} hr = ${finalRate.toFixed(2)} bbl/hr`;
                        }
                        
                        actualRate = finalRate;
                        
                        testResults.push({
                            test: `Ø­Ø³Ø§Ø¨ Rate (${rateUnit})`,
                            result: `âœ… BPM: ${bpm} â†’ ${calculationDetails}`,
                            status: 'success'
                        });
                    } else {
                        testResults.push({
                            test: `Ø­Ø³Ø§Ø¨ Rate (${rateUnit})`,
                            result: `âŒ BPM ØºÙŠØ± Ù…ØªØ§Ø­ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (${bpm})`,
                            status: 'error'
                        });
                    }
                } else {
                    testResults.push({
                        test: `Ø­Ø³Ø§Ø¨ Rate (${rateUnit})`,
                        result: `âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø­Ø³Ø§Ø¨ - Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø²Ø§Ù† ØºÙŠØ± Ù…ØªØ§Ø­Ø©`,
                        status: 'error'
                    });
                }

                testResults.push({
                    test: 'Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©',
                    result: `âœ… Rate = ${actualRate.toFixed(2)} ${rateUnit}`,
                    status: actualRate > 0 ? 'success' : 'warning'
                });

                displayResults(testResults, 'fixed');
                displayData(allTanksInPath, 'fixed', tankNumber, department);
                displayCalculations({
                    method: 'fixed',
                    tankNumber,
                    rateUnit,
                    tankData,
                    rate: actualRate,
                    calculation: calculationDetails,
                    bpm: tankData ? (parseFloat(tankData.comment) || parseFloat(tankData.factor) || 0) : 0
                });

            } catch (error) {
                displayResults([{
                    test: 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…ÙØµÙ„Ø­',
                    result: `âŒ ${error.message}`,
                    status: 'error'
                }], 'fixed');
            }
        }

        function displayResults(results, type = '') {
            const resultsDiv = document.getElementById('testResults');
            
            if (typeof results === 'string') {
                resultsDiv.innerHTML = `<p>${results}</p>`;
                return;
            }
            
            let html = `<h4>ğŸ“Š Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ${type === 'current' ? '(Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©)' : type === 'fixed' ? '(Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…ÙØµÙ„Ø­Ø©)' : ''}:</h4>`;
            
            results.forEach((result, index) => {
                html += `
                    <div class="result-item ${result.status}">
                        <strong>${index + 1}. ${result.test}:</strong><br>
                        ${result.result}
                    </div>
                `;
            });
            
            resultsDiv.innerHTML = html;
        }

        function displayData(data, type = '', tankNumber = '', department = '') {
            const dataDiv = document.getElementById('firebaseData');
            
            if (typeof data === 'string') {
                dataDiv.innerHTML = `<h4>ğŸ“ Ø¨ÙŠØ§Ù†Ø§Øª Firebase:</h4><div>${data}</div>`;
                return;
            }
            
            let html = `<h4>ğŸ“ Ø¨ÙŠØ§Ù†Ø§Øª Firebase ${type === 'fixed' ? '(Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…ÙØµÙ„Ø­Ø©)' : ''}:</h4>`;
            
            if (Object.keys(data).length > 0) {
                html += `<div><strong>Ø§Ù„Ù…Ø³Ø§Ø±:</strong> tankData/${department}/tanks</div>`;
                html += `<div><strong>Ø§Ù„Ø®Ø²Ø§Ù†Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©:</strong> ${Object.keys(data).join(', ')}</div>`;
                
                if (data[tankNumber]) {
                    html += `<div><strong>Tank ${tankNumber} Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:</strong></div>`;
                    html += `<pre>${JSON.stringify(data[tankNumber], null, 2)}</pre>`;
                } else {
                    html += `<div>âŒ Tank ${tankNumber} ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³Ø§Ø±</div>`;
                }
            } else {
                html += `<div>âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</div>`;
            }
            
            dataDiv.innerHTML = html;
        }

        function displayCalculations(calc) {
            const calcDiv = document.getElementById('calculationDetails');
            
            let html = `<h4>ğŸ”¢ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ ${calc.method === 'fixed' ? '(Ø§Ù„Ù…ÙØµÙ„Ø­)' : '(Ø§Ù„Ø­Ø§Ù„ÙŠ)'}:</h4>`;
            
            html += `<div><strong>Tank Number:</strong> ${calc.tankNumber}</div>`;
            html += `<div><strong>Rate Unit:</strong> ${calc.rateUnit}</div>`;
            html += `<div><strong>Tank Data Available:</strong> ${calc.tankData ? 'âœ… Ù†Ø¹Ù…' : 'âŒ Ù„Ø§'}</div>`;
            
            if (calc.tankData) {
                html += `<div><strong>BPM Value:</strong> ${calc.bmp || 'N/A'}</div>`;
            }
            
            if (calc.calculation) {
                html += `<div><strong>Ø§Ù„Ø­Ø³Ø§Ø¨:</strong> ${calc.calculation}</div>`;
            }
            
            if (calc.error) {
                html += `<div style="color: #FF3B30;"><strong>Ø®Ø·Ø£:</strong> ${calc.error}</div>`;
            }
            
            html += `<div class="rate-comparison">
                <div class="rate-box rate-${calc.method === 'fixed' ? 'new' : 'old'}">
                    <div>Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</div>
                    <div class="rate-value">${calc.rate.toFixed(2)}</div>
                    <div>${calc.rateUnit}</div>
                </div>
            </div>`;
            
            calcDiv.innerHTML = html;
        }

        function clearData() {
            document.getElementById('firebaseData').innerHTML = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...';
            document.getElementById('calculationDetails').innerHTML = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨...';
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ§ª Rate calculation test page loaded');
        });
    </script>
</body>
</html>