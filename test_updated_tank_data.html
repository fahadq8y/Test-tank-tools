<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø© Ù„Ù„Ø®Ø²Ø§Ù†Ø§Øª</title>
  <style>
    body { font-family: monospace; padding: 20px; background: #1a1a2e; color: #eee; }
    .container { max-width: 1200px; margin: 0 auto; }
    .section { background: #16213e; padding: 20px; margin: 15px 0; border-radius: 8px; }
    .success { border-left: 5px solid #28a745; }
    .info { border-left: 5px solid #17a2b8; }
    .tank-data { display: grid; grid-template-columns: 80px 80px 80px 100px 150px; gap: 10px; padding: 8px; margin: 3px 0; background: #0f1419; border-radius: 4px; font-size: 12px; }
    .header { background: #2c3e50; font-weight: bold; color: #fff; }
    .tank-id { color: #ffc107; font-weight: bold; }
    .hi-level { color: #17a2b8; }
    .lo-level { color: #6f42c1; }
    .bmp-value { color: #28a745; font-weight: bold; }
    .status { color: #28a745; }
    button { background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="section success">
      <h1>âœ… Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø© Ù„Ù„Ø®Ø²Ø§Ù†Ø§Øª</h1>
      <p>ÙØ­Øµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙŠ ØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡Ø§ Ù…Ù† Ù†Ø¸Ø§Ù… KNPC</p>
    </div>

    <div class="section">
      <h2>ğŸ¯ Ø¹ÙŠÙ†Ø§Øª Ù…Ù† Ø§Ù„Ø®Ø²Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø©</h2>
      <button onclick="testUpdatedData()">ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø©</button>
      <button onclick="showRandomSample()">ğŸ“Š Ø¹Ø±Ø¶ Ø¹ÙŠÙ†Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©</button>
    </div>

    <div class="section">
      <h2>ğŸ“‹ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h2>
      <div class="tank-data header">
        <span>Ø±Ù‚Ù… Ø§Ù„Ø®Ø²Ø§Ù†</span>
        <span>Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¹Ø§Ù„ÙŠ</span>
        <span>Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ù†Ø®ÙØ¶</span>
        <span>Ù‚ÙŠÙ…Ø© BPM</span>
        <span>Ø§Ù„Ø­Ø§Ù„Ø©</span>
      </div>
      <div id="testResults"></div>
    </div>

    <div class="section info">
      <h2>ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h2>
      <div id="testReport">Ø§Ø¶ØºØ· "Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø©" Ù„Ø¨Ø¯Ø¡ Ø§Ù„ÙØ­Øµ...</div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore, doc, getDoc, collection, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyD7lJcoY33FEC9d6eWy67QIO9SV4lS24pg",
      authDomain: "tank-tools-knpc-c2d95.firebaseapp.com",
      projectId: "tank-tools-knpc-c2d95",
      storageBucket: "tank-tools-knpc-c2d95.firebasestorage.app",
      messagingSenderId: "510062594324",
      appId: "1:510062594324:web:b892fd02007a5ca2f0da01"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Ø¹ÙŠÙ†Ø© Ù…Ù† Ø§Ù„Ø®Ø²Ø§Ù†Ø§Øª Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
    const testTanks = ['221', '225', '255', '272', '301', '510', '600', '633', '756', '820'];

    function displayTankData(tankId, data, status) {
      const container = document.getElementById('testResults');
      const row = document.createElement('div');
      row.className = 'tank-data';
      
      row.innerHTML = `
        <span class="tank-id">TK-${tankId}</span>
        <span class="hi-level">${data.max || 'N/A'}m</span>
        <span class="lo-level">${data.min || 'N/A'}m</span>
        <span class="bpm-value">${data.comment || 'N/A'} BPM</span>
        <span class="status">${status}</span>
      `;
      container.appendChild(row);
    }

    window.testUpdatedData = async function() {
      const container = document.getElementById('testResults');
      const reportDiv = document.getElementById('testReport');
      container.innerHTML = '';
      
      reportDiv.innerHTML = 'ğŸ” Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø©...<br>';
      
      let successCount = 0;
      let totalTested = testTanks.length;
      
      try {
        for (const tankId of testTanks) {
          const tankRef = doc(db, 'tankData', 'pbcr', 'tanks', tankId);
          const tankDoc = await getDoc(tankRef);
          
          if (tankDoc.exists()) {
            const data = tankDoc.data();
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø©
            const hasValidData = data.comment && data.max && data.min;
            const isUpdated = data.source && data.source.includes('knpc');
            
            let status = '';
            if (hasValidData && isUpdated) {
              status = 'âœ… Ù…Ø­Ø¯Ø« Ø¨Ù†Ø¬Ø§Ø­';
              successCount++;
            } else if (hasValidData) {
              status = 'âš ï¸ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ¬ÙˆØ¯Ø©';
            } else {
              status = 'âŒ Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©';
            }
            
            displayTankData(tankId, data, status);
            
          } else {
            displayTankData(tankId, {}, 'âŒ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
          }
          
          await new Promise(resolve => setTimeout(resolve, 200));
        }
        
        const successRate = ((successCount / totalTested) * 100).toFixed(1);
        
        reportDiv.innerHTML = `
          <strong>ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:</strong><br>
          â€¢ ØªÙ… Ø§Ø®ØªØ¨Ø§Ø±: ${totalTested} Ø®Ø²Ø§Ù†<br>
          â€¢ Ù†Ø¬Ø­ Ø§Ù„ØªØ­Ø¯ÙŠØ«: ${successCount} Ø®Ø²Ø§Ù†<br>
          â€¢ Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­: ${successRate}%<br>
          â€¢ Ø§Ù„Ø­Ø§Ù„Ø©: ${successRate >= 80 ? 'âœ… Ù…Ù…ØªØ§Ø²' : successRate >= 60 ? 'âš ï¸ Ø¬ÙŠØ¯' : 'âŒ ÙŠØ­ØªØ§Ø¬ Ù…Ø±Ø§Ø¬Ø¹Ø©'}<br><br>
          
          <strong>ğŸ¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong><br>
          â€¢ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®Ø²Ø§Ù†Ø§Øª Ø§Ù„ØªÙŠ ØªØ¸Ù‡Ø± "Ù…Ø­Ø¯Ø« Ø¨Ù†Ø¬Ø§Ø­" ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª KNPC Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©<br>
          â€¢ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªØ´Ù…Ù„: Hi Level, Lo Level, ÙˆÙ‚ÙŠÙ…Ø© BPM Ø§Ù„ØµØ­ÙŠØ­Ø©<br>
          â€¢ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¢Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø­Ø³Ø§Ø¨Ø§Øª PBCR Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©
        `;
        
      } catch (error) {
        reportDiv.innerHTML = `âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: ${error.message}`;
      }
    };

    window.showRandomSample = async function() {
      const container = document.getElementById('testResults');
      container.innerHTML = '';
      
      try {
        const tanksRef = collection(db, 'tankData', 'pbcr', 'tanks');
        const snapshot = await getDocs(tanksRef);
        
        const allTanks = [];
        snapshot.forEach(doc => {
          const data = doc.data();
          if (data.source && data.source.includes('knpc')) {
            allTanks.push({ id: doc.id, data });
          }
        });
        
        // Ø¹Ø±Ø¶ 10 Ø®Ø²Ø§Ù†Ø§Øª Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ù…Ø­Ø¯Ø«Ø©
        const randomTanks = allTanks.sort(() => 0.5 - Math.random()).slice(0, 10);
        
        randomTanks.forEach(tank => {
          displayTankData(tank.id, tank.data, 'âœ… Ù…Ø­Ø¯Ø« Ù…Ù† KNPC');
        });
        
        document.getElementById('testReport').innerHTML = `
          ğŸ“Š ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${allTanks.length} Ø®Ø²Ø§Ù† Ù…Ø­Ø¯Ø« Ø¨Ø¨ÙŠØ§Ù†Ø§Øª KNPC<br>
          Ø¹Ø±Ø¶ Ø¹ÙŠÙ†Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ù…Ù† ${randomTanks.length} Ø®Ø²Ø§Ù†
        `;
        
      } catch (error) {
        document.getElementById('testReport').innerHTML = `âŒ Ø®Ø·Ø£: ${error.message}`;
      }
    };

    console.log('âœ… Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø© Ø¬Ø§Ù‡Ø²');
  </script>
</body>
</html>