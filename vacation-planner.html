<!DOCTYPE html>
<!-- Vacation Planner v2.8 - Using Firebase Auth Handler -->
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Ù…Ø®Ø·Ø· Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª - Vacation Planner</title>
  <link href="icon.png" rel="icon" type="image/png"/>
  <script src="permissions.js"></script>
  <script src="session-manager.js"></script>
  <script src="last-page-tracker.js"></script>
  <style>
    /* === CSS Variables & Themes === */
    :root {
      --primary: #B8860B;
      --secondary: #8B4513;
      --accent: #CD853F;
      --text: #FFD700;
    }
    
    [data-theme="ocean"] {
      --primary: #1e3a5f;
      --secondary: #2c5f8d;
      --accent: #4a90c4;
      --text: #87CEEB;
    }
    
    [data-theme="dark"] {
      --primary: #2c2c2c;
      --secondary: #1a1a1a;
      --accent: #ff6b35;
      --text: #ff6b35;
    }
    
    [data-theme="sunset"] {
      --primary: #ff6b35;
      --secondary: #f7931e;
      --accent: #ffd700;
      --text: #ffd700;
    }
    
    [data-theme="forest"] {
      --primary: #2d5016;
      --secondary: #4a7c59;
      --accent: #6b9b37;
      --text: #90EE90;
    }
    
    /* Theme Switcher */
    .theme-switcher {
      position: relative;
      display: inline-block;
    }
    
    .theme-btn {
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.3);
      color: white;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 18px;
      transition: all 0.3s ease;
      min-width: 36px;
      min-height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .theme-btn:hover {
      background: rgba(255,255,255,0.2);
      transform: translateY(-1px);
    }
    
    .theme-dropdown {
      display: none;
      position: absolute;
      top: 100%;
      right: 0;
      margin-top: 5px;
      background: rgba(0,0,0,0.9);
      border-radius: 8px;
      min-width: 180px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      z-index: 10000;
      border: 1px solid rgba(255,255,255,0.2);
    }
    
    .theme-dropdown.show {
      display: block;
      animation: slideDown 0.3s ease;
    }
    
    .theme-option {
      padding: 10px 15px;
      cursor: pointer;
      color: white;
      transition: all 0.2s ease;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .theme-option:last-child {
      border-bottom: none;
    }
    
    .theme-option:hover {
      background: rgba(255,255,255,0.1);
    }
    
    .theme-option.active {
      background: var(--primary);
      font-weight: bold;
    }
    
    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('background.jpg');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      color: white;
      font-family: Arial, sans-serif;
      min-height: 100vh;
    }
    
    /* Navigation Bar */
    .nav-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 30px;
      background: rgba(0,0,0,0.5);
      backdrop-filter: blur(10px);
      border-bottom: 2px solid var(--primary);
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 15px;
      position: relative;
      z-index: 1000;
    }
    
    .nav-logo {
      font-size: 24px;
      font-weight: bold;
      color: var(--primary);
    }
    
    .nav-links {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }
    
    .nav-link {
      color: white;
      text-decoration: none;
      padding: 8px 16px;
      border-radius: 8px;
      transition: all 0.3s ease;
      background: rgba(255,255,255,0.1);
      font-weight: 500;
      border: 1px solid rgba(255,255,255,0.2);
    }
    
    .nav-link:hover {
      background: var(--primary);
      transform: translateY(-1px);
    }
    
    .user-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    /* Font Controls */
    .font-controls {
      display: flex;
      gap: 5px;
    }
    
    .font-btn {
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.3);
      color: white;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      transition: all 0.3s ease;
      min-width: 32px;
      min-height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .font-btn:hover {
      background: rgba(255,255,255,0.2);
      transform: translateY(-1px);
    }
    
    /* User Avatar */
    .user-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: linear-gradient(45deg, var(--primary), var(--secondary));
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 14px;
      color: white;
      border: 2px solid var(--accent);
    }
    
    .user-name {
      background: rgba(255,255,255,0.1);
      padding: 6px 12px;
      border-radius: 5px;
      border: 1px solid rgba(255,255,255,0.2);
      font-size: 14px;
    }
    
    .logout-btn {
      background: rgba(255,0,0,0.3);
      color: white;
      border: 1px solid rgba(255,0,0,0.5);
      padding: 6px 12px;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 14px;
    }
    
    .logout-btn:hover {
      background: rgba(255,0,0,0.5);
      transform: translateY(-2px);
    }
    
    /* Main Container */
    .main-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .page-title {
      text-align: center;
      font-size: 32px;
      margin-bottom: 30px;
      color: var(--primary);
      text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    }
    
    /* Cards */
    .card {
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 20px;
      border: 1px solid rgba(255,255,255,0.2);
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }
    
    .card-title {
      font-size: 20px;
      margin-bottom: 20px;
      color: #4CAF50;
      border-bottom: 2px solid rgba(76,175,80,0.3);
      padding-bottom: 10px;
    }
    
    /* Form */
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #fff;
    }
    
    .form-input, .form-select {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.3);
      background: rgba(255,255,255,0.9);
      color: #003366;
      font-size: 16px;
      transition: all 0.3s;
    }
    
    .form-input:focus, .form-select:focus {
      outline: none;
      border-color: #4CAF50;
      box-shadow: 0 0 10px rgba(76,175,80,0.3);
    }
    
    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
    }
    
    /* Shift Info Display */
    .shift-info {
      background: rgba(76,175,80,0.2);
      border: 2px solid #4CAF50;
      border-radius: 8px;
      padding: 12px;
      margin-top: 10px;
      font-weight: bold;
      text-align: center;
    }
    
    .shift-info.warning {
      background: rgba(255,152,0,0.2);
      border-color: #FF9800;
      color: #FFB74D;
    }
    
    .shift-info.error {
      background: rgba(244,67,54,0.2);
      border-color: #f44336;
      color: #EF5350;
    }
    
    /* Buttons */
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      display: inline-block;
      text-align: center;
    }
    
    .btn-primary {
      background: linear-gradient(45deg, var(--primary), var(--secondary));
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px var(--primary);
    }
    
    .btn-secondary {
      background: linear-gradient(45deg, #2196F3, #1976D2);
      color: white;
    }
    
    .btn-secondary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(33,150,243,0.4);
    }
    
    .btn-danger {
      background: linear-gradient(45deg, #f44336, #d32f2f);
      color: white;
    }
    
    .btn-danger:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(244,67,54,0.4);
    }
    
    .btn-group {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-top: 20px;
    }
    
    /* Leave List */
    .leave-item {
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 10px;
      border-left: 4px solid #4CAF50;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .leave-info {
      flex: 1;
    }
    
    .leave-dates {
      font-size: 14px;
      color: #4CAF50;
      margin-bottom: 5px;
    }
    
    .leave-shift-type {
      font-size: 12px;
      opacity: 0.8;
    }
    
    /* Loading */
    .loading {
      text-align: center;
      padding: 40px;
    }
    
    .loading-spinner {
      border: 4px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top: 4px solid #4CAF50;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Alert */
    .alert {
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-weight: bold;
    }
    
    .alert-success {
      background: rgba(76,175,80,0.2);
      border: 2px solid #4CAF50;
      color: #4CAF50;
    }
    
    .alert-error {
      background: rgba(244,67,54,0.2);
      border: 2px solid #f44336;
      color: #f44336;
    }
    
    .alert-warning {
      background: rgba(255,152,0,0.2);
      border: 2px solid #FF9800;
      color: #FF9800;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .nav-bar {
        flex-direction: column;
        align-items: flex-start;
        padding: 10px 15px;
      }
      
      .nav-logo {
        font-size: 18px;
      }
      
      .nav-links {
        width: 100%;
        justify-content: center;
        gap: 5px;
      }
      
      .nav-link {
        padding: 6px 10px;
        font-size: 12px;
      }
      
      .container {
        padding: 15px;
      }
      
      .section {
        padding: 15px;
      }
      
      .section-title {
        font-size: 18px;
      }
      
      .form-row {
        grid-template-columns: 1fr;
        gap: 10px;
      }
      
      .form-label {
        font-size: 14px;
      }
      
      .form-input, .form-select {
        font-size: 14px;
        padding: 10px;
      }
      
      .btn-group {
        flex-direction: column;
        gap: 10px;
      }
      
      .btn {
        width: 100%;
        font-size: 14px;
        padding: 10px;
      }
      
      .leave-card {
        padding: 12px;
      }
      
      .leave-dates {
        font-size: 14px;
      }
      
      .leave-shift {
        font-size: 12px;
      }
      
      .annual-roster {
        overflow-x: auto;
      }
      
      .month-grid {
        min-width: 280px;
      }
      
      .month-name {
        font-size: 14px;
        padding: 8px;
      }
      
      .day-cell {
        font-size: 11px;
        padding: 4px 2px;
      }
      
      .conflict-count {
        font-size: 9px;
      }
    }
    
    @media (max-width: 480px) {
      body {
        font-size: 14px;
      }
      
      .nav-bar {
        padding: 8px 10px;
      }
      
      .nav-logo {
        font-size: 14px;
        width: 100%;
        text-align: center;
        margin-bottom: 5px;
      }
      
      .nav-link {
        padding: 4px 6px;
        font-size: 10px;
      }
      
      .font-controls {
        gap: 3px;
      }
      
      .font-btn {
        min-width: 28px;
        min-height: 28px;
        padding: 4px 8px;
        font-size: 14px;
      }
      
      .user-avatar {
        width: 28px;
        height: 28px;
        font-size: 12px;
      }
      
      .user-name {
        font-size: 11px;
        padding: 3px 6px;
      }
      
      .logout-btn {
        font-size: 11px;
        padding: 3px 6px;
      }
      
      .main-container {
        padding: 10px;
      }
      
      .page-title {
        font-size: 18px;
        margin-bottom: 15px;
      }
      
      .card {
        padding: 12px;
        margin-bottom: 15px;
      }
      
      .card-title {
        font-size: 16px;
        margin-bottom: 12px;
      }
      
      .section-title {
        font-size: 14px;
      }
      
      .form-group {
        margin-bottom: 10px;
      }
      
      .form-label {
        font-size: 12px;
        margin-bottom: 4px;
      }
      
      .form-input, .form-select {
        font-size: 12px;
        padding: 8px;
      }
      
      .form-select {
        max-width: 100%;
        width: 100%;
      }
      
      .btn {
        font-size: 12px;
        padding: 8px 12px;
      }
      
      .shift-info {
        font-size: 11px;
        padding: 8px;
      }
      
    .leave-card {
      padding: 10px;
    }
    
    .leave-item {
      flex-direction: column;
      align-items: flex-start;
      padding: 12px;
    }
    
    .leave-info {
      width: 100%;
      margin-bottom: 10px;
    }
    
    .leave-dates {
      font-size: 13px;
      word-wrap: break-word;
    }
    
    .leave-shift-type {
      font-size: 11px;
      white-space: normal;
      word-wrap: break-word;
    }
    
    .leave-shift {
      font-size: 10px;
    }
    
    .btn-danger {
      width: 100%;
      padding: 10px;
      font-size: 14px;
    }
      
      .alert {
        padding: 10px;
        font-size: 12px;
      }
      
      .alert h3 {
        font-size: 14px;
      }
      
      .month-name {
        font-size: 11px;
        padding: 5px;
      }
      
      .day-cell {
        font-size: 9px;
        padding: 2px 1px;
      }
      
      .conflict-count {
        font-size: 7px;
      }
      
      .modal-content {
        width: 95%;
        padding: 15px;
        max-height: 85vh;
      }
      
      .modal-title {
        font-size: 16px;
        margin-bottom: 12px;
      }
      
      .modal-close {
        width: 28px;
        height: 28px;
        font-size: 24px;
      }
      
      .custom-calendar {
        padding: 10px;
      }
      
      .calendar-month-year {
        font-size: 14px;
      }
      
      .calendar-nav-btn {
        padding: 6px 10px;
        font-size: 14px;
      }
      
      .calendar-weekday {
        font-size: 11px;
        padding: 3px;
      }
      
      .calendar-day {
        font-size: 11px;
        min-width: 0;
        padding: 3px 1px;
      }
      
      .calendar-day-number {
        font-size: 11px;
      }
      
      .calendar-day-shift {
        font-size: 7px;
        line-height: 1;
      }
      
      .calendar-days {
        gap: 3px;
      }
      
      .calendar-weekdays {
        gap: 3px;
      }
      
      .calendar-weekday {
        font-size: 10px;
        padding: 2px;
      }
    }
    
    /* Landscape Mode (Phones in horizontal orientation) */
    @media (max-height: 500px) and (orientation: landscape) {
      .leave-item {
        flex-direction: row;
        align-items: center;
        padding: 10px;
      }
      
      .leave-info {
        width: auto;
        flex: 1;
        margin-bottom: 0;
        margin-left: 10px;
      }
      
      .leave-dates {
        font-size: 11px;
        word-wrap: break-word;
      }
      
      .leave-shift-type {
        font-size: 10px;
        white-space: normal;
        word-wrap: break-word;
      }
      
      .btn-danger {
        width: auto;
        padding: 8px 12px;
        font-size: 12px;
        white-space: nowrap;
      }
    }
    
    /* Modal */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(5px);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .modal-content {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      border-radius: 15px;
      padding: 25px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
      border: 2px solid #4CAF50;
      box-shadow: 0 10px 40px rgba(0,0,0,0.5);
    }
    
    .modal-close {
      position: absolute;
      top: 15px;
      left: 15px;
      font-size: 30px;
      color: #fff;
      cursor: pointer;
      transition: all 0.3s;
      width: 35px;
      height: 35px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      background: rgba(255,0,0,0.2);
    }
    
    .modal-close:hover {
      background: rgba(255,0,0,0.4);
      transform: rotate(90deg);
    }
    
    .modal-title {
      color: #4CAF50;
      font-size: 22px;
      margin-bottom: 20px;
      text-align: center;
    }
    
    /* Custom Calendar */
    .custom-calendar {
      background: rgba(255,255,255,0.05);
      border: 2px solid rgba(255,255,255,0.2);
      border-radius: 10px;
      padding: 15px;
      margin-top: 10px;
    }
    
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .calendar-nav-btn {
      background: rgba(76,175,80,0.3);
      border: 1px solid #4CAF50;
      color: white;
      padding: 8px 15px;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 18px;
    }
    
    .calendar-nav-btn:hover {
      background: rgba(76,175,80,0.5);
    }
    
    .calendar-month-year {
      font-size: 18px;
      font-weight: bold;
      color: #4CAF50;
    }
    
    .calendar-weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
      margin-bottom: 10px;
    }
    
    .calendar-weekday {
      text-align: center;
      font-weight: bold;
      color: #4CAF50;
      font-size: 14px;
      padding: 5px;
    }
    
    .calendar-days {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
    }
    
    .calendar-day {
      aspect-ratio: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
      font-size: 14px;
      border: 2px solid transparent;
    }
    
    .calendar-day:hover {
      transform: scale(1.05);
      box-shadow: 0 0 10px rgba(76,175,80,0.5);
    }
    
    .calendar-day.empty {
      cursor: default;
      opacity: 0;
    }
    
    .calendar-day.empty:hover {
      transform: none;
      box-shadow: none;
    }
    
    .calendar-day.selected {
      border-color: var(--text);
      box-shadow: 0 0 15px var(--accent);
    }
    
    .calendar-day.shift-M {
      background: rgba(76,175,80,0.3);
      border-color: #4CAF50;
    }
    
    .calendar-day.shift-A {
      background: rgba(255,152,0,0.3);
      border-color: #FF9800;
    }
    
    .calendar-day.shift-N {
      background: rgba(33,150,243,0.3);
      border-color: #2196F3;
    }
    
    .calendar-day.shift-O {
      background: rgba(158,158,158,0.3);
      border-color: #9E9E9E;
    }
    
    .calendar-day-number {
      font-weight: bold;
      margin-bottom: 2px;
    }
    
    .calendar-day-shift {
      font-size: 10px;
      opacity: 0.9;
    }
    
    .calendar-day-holiday {
      position: absolute;
      top: 2px;
      right: 2px;
      width: 6px;
      height: 6px;
      background: red;
      border-radius: 50%;
    }
  </style>
</head>
<body>
  <!-- Navigation Bar -->
  <div class="nav-bar">
    <div class="nav-logo">ğŸ–ï¸ Ù…Ø®Ø·Ø· Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª - Vacation Planner v2.8</div>
    <div class="nav-links">
      <a href="index.html" class="nav-link">ğŸ›¢ï¸ PBCR</a>
      <a href="plcr.html" class="nav-link">âš—ï¸ PLCR</a>
      <a href="live-tanks.html" class="nav-link">ğŸ”´ Live Tanks</a>
      <a href="shift-roster.html" class="nav-link">ğŸ“… Shift Roster</a>
      <a href="dashboard.html" class="nav-link">ğŸ“Š Dashboard</a>
      <button class="nav-link" onclick="toggleTestMode()" style="background: rgba(255,152,0,0.3); border-color: #FF9800;">ğŸ§ª Test Mode</button>
      <div class="user-info">
        <div class="font-controls">
          <button class="font-btn" onclick="decreaseFontSize()" title="ØªØµØºÙŠØ± Ø§Ù„Ø®Ø·">-</button>
          <button class="font-btn" onclick="increaseFontSize()" title="ØªÙƒØ¨ÙŠØ± Ø§Ù„Ø®Ø·">+</button>
        </div>
        <div class="theme-switcher">
          <button class="theme-btn" onclick="toggleThemeDropdown()" title="Change Theme">ğŸ¨</button>
          <div class="theme-dropdown" id="themeDropdown">
            <div class="theme-option active" data-theme="industrial" onclick="setTheme('industrial')">ğŸ­ Industrial Bronze</div>
            <div class="theme-option" data-theme="ocean" onclick="setTheme('ocean')">ğŸŒŠ Ocean Blue</div>
            <div class="theme-option" data-theme="dark" onclick="setTheme('dark')">âš« Dark Carbon</div>
            <div class="theme-option" data-theme="sunset" onclick="setTheme('sunset')">ğŸŒ… Sunset Amber</div>
            <div class="theme-option" data-theme="forest" onclick="setTheme('forest')">ğŸŒ² Forest Green</div>
          </div>
        </div>
        <div class="user-avatar" id="userAvatar">U</div>
        <span class="user-name" id="userName">Loading...</span>
        <button class="logout-btn" onclick="handleLogout()">ğŸšº Logout</button>
      </div>
    </div>
  </div>
  
  <!-- Main Container -->
  <div class="main-container">
    <h1 class="page-title">ğŸ–ï¸ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª</h1>
    
    <!-- My Leaves Card -->
    <div class="card">
      <h2 class="card-title">ğŸ“‹ Ø¥Ø¬Ø§Ø²Ø§ØªÙŠ (3 Ø¥Ø¬Ø§Ø²Ø§Øª Ù…ØªØ§Ø­Ø©)</h2>
      
      <!-- Shift Selection -->
      <div class="form-group">
        <label class="form-label">Ø§Ø®ØªØ± Ø´ÙØªÙƒ:</label>
        <select class="form-select" id="userShift" onchange="updateShiftInfo()">
          <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø´ÙØª --</option>
          <option value="A">A Shift</option>
          <option value="B">B Shift</option>
          <option value="C">C Shift</option>
          <option value="D">D Shift</option>
        </select>
      </div>
      
      <!-- Leave Selector -->
      <div id="leaveSelector" style="display:none; margin-bottom: 20px;">
        <div class="form-group">
          <label class="form-label">Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©:</label>
          <select class="form-select" id="leaveNumber" onchange="selectLeave()">
            <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¬Ø§Ø²Ø© --</option>
            <option value="1">Ø§Ù„Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰</option>
            <option value="2">Ø§Ù„Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©</option>
            <option value="3">Ø§Ù„Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©</option>
          </select>
        </div>
      </div>
      
      <!-- Leave Form -->
      <div id="leaveForm" style="display:none;">
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©:</label>
            <input type="text" class="form-input" id="startDate" readonly onclick="openStartCalendar()" placeholder="Ø§Ø®ØªØ± ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©" style="cursor:pointer;">
            <div id="startDateInfo" class="shift-info" style="display:none;"></div>
          </div>
          
          <div class="form-group">
            <label class="form-label">ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©:</label>
            <input type="text" class="form-input" id="endDate" readonly onclick="openEndCalendar()" placeholder="Ø§Ø®ØªØ± ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©" style="cursor:pointer;">
            <div id="endDateInfo" class="shift-info" style="display:none;"></div>
          </div>
        </div>
        
        <div class="btn-group">
          <button class="btn btn-primary" onclick="saveLeave()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©</button>
          <button class="btn btn-secondary" onclick="resetForm()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
        </div>
      </div>
      
      <!-- My Leaves List -->
      <div id="myLeavesList" style="margin-top: 30px;">
        <h3 style="color: #4CAF50; margin-bottom: 15px;">Ø¥Ø¬Ø§Ø²Ø§ØªÙŠ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©:</h3>
        <div id="leavesContainer">
          <p style="text-align: center; opacity: 0.7;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¬Ø§Ø²Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©</p>
        </div>
      </div>
    </div>
    
    <!-- Annual Roster Card -->
    <div class="card">
      <h2 class="card-title">ğŸ“Š Ø§Ù„Ø±ÙˆØ³ØªØ± Ø§Ù„Ø³Ù†ÙˆÙŠ Ù„Ù„Ø¥Ø¬Ø§Ø²Ø§Øª</h2>
      
      <!-- Year Selector -->
      <div class="form-group">
        <label class="form-label">Ø§Ø®ØªØ± Ø§Ù„Ø³Ù†Ø©:</label>
        <select class="form-select" id="rosterYear" onchange="renderAnnualRoster()">
          <option value="2025">2025</option>
          <option value="2026" selected>2026</option>
          <option value="2027">2027</option>
        </select>
      </div>
      
      <!-- Legend -->
      <div style="display: flex; gap: 15px; justify-content: center; margin: 20px 0; flex-wrap: wrap;">
        <div style="display: flex; align-items: center; gap: 5px;">
          <div style="width: 20px; height: 20px; background: rgba(76,175,80,0.3); border-radius: 4px;"></div>
          <span style="font-size: 14px;">âœ… 1-2 Ø£Ø´Ø®Ø§Øµ</span>
        </div>
        <div style="display: flex; align-items: center; gap: 5px;">
          <div style="width: 20px; height: 20px; background: rgba(255,152,0,0.3); border-radius: 4px;"></div>
          <span style="font-size: 14px;">âš ï¸ 3 Ø£Ø´Ø®Ø§Øµ (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰)</span>
        </div>
        <div style="display: flex; align-items: center; gap: 5px;">
          <div style="width: 20px; height: 20px; background: rgba(244,67,54,0.3); border-radius: 4px;"></div>
          <span style="font-size: 14px;">ğŸ”´ 4+ Ø£Ø´Ø®Ø§Øµ (ØªØ¹Ø§Ø±Ø¶!)</span>
        </div>
      </div>
      
      <!-- Annual Roster Grid -->
      <div id="annualRosterGrid" style="overflow-x: auto;">
        <p style="text-align: center; opacity: 0.7;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
      </div>
      
      <!-- Conflict Suggestions -->
      <div id="conflictSuggestions" style="margin-top: 20px;"></div>
    </div>
  </div>
  
  <!-- Day Details Modal -->
  <div id="dayDetailsModal" class="modal" style="display:none;">
    <div class="modal-content">
      <span class="modal-close" onclick="closeDayDetailsModal()">&times;</span>
      <h2 class="modal-title" id="modalTitle">ğŸ“… ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…</h2>
      <div id="modalBody">
        <p style="text-align: center;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
      </div>
    </div>
  </div>
  
  <!-- Custom Calendar Modal -->
  <div id="calendarModal" class="modal" style="display:none;">
    <div class="modal-content">
      <span class="modal-close" onclick="closeCalendar()">&times;</span>
      <h2 class="modal-title" id="calendarTitle">ğŸ“… Ø§Ø®ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ®</h2>
      <div id="calendarContainer"></div>
    </div>
  </div>
  
  <!-- Test Mode Modal -->
  <div id="testModeModal" class="modal" style="display:none;">
    <div class="modal-content" style="max-width: 700px;">
      <span class="modal-close" onclick="closeTestMode()">&times;</span>
      <h2 class="modal-title">ğŸ§ª ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± - Test Mode</h2>
      <p style="text-align: center; margin-bottom: 20px; opacity: 0.8;">
        Ø£Ø¶Ù Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆÙ‡Ù…ÙŠÙŠÙ† ÙˆØ¥Ø¬Ø§Ø²Ø§ØªÙ‡Ù… Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ¹Ø§Ø±Ø¶Ø§Øª
      </p>
      <div id="testModeContainer"></div>
    </div>
  </div>
  
  <script>
    // ========== FONT SIZE FUNCTIONS ==========
    window.currentFontSize = 100; // percentage
    
    window.increaseFontSize = function() {
      console.log('Increasing font size from:', window.currentFontSize);
      if (window.currentFontSize < 150) {
        window.currentFontSize += 10;
        window.applyFontSize();
        window.saveFontSize();
        console.log('Font size increased to:', window.currentFontSize);
      } else {
        console.log('Maximum font size reached (150%)');
      }
    }
    
    window.decreaseFontSize = function() {
      console.log('Decreasing font size from:', window.currentFontSize);
      if (window.currentFontSize > 70) {
        window.currentFontSize -= 10;
        window.applyFontSize();
        window.saveFontSize();
        console.log('Font size decreased to:', window.currentFontSize);
      } else {
        console.log('Minimum font size reached (70%)');
      }
    }
    
    window.applyFontSize = function() {
      // Apply to body instead of html for better mobile support
      document.body.style.fontSize = window.currentFontSize + '%';
      console.log('Applied font size to body:', window.currentFontSize + '%');
    }
    
    window.saveFontSize = function() {
      localStorage.setItem('fontSize', window.currentFontSize);
      console.log('Saved font size to localStorage:', window.currentFontSize);
    }
    
    window.loadFontSize = function() {
      const savedSize = localStorage.getItem('fontSize');
      if (savedSize) {
        window.currentFontSize = parseInt(savedSize);
        window.applyFontSize();
        console.log('Loaded font size from localStorage:', window.currentFontSize);
      } else {
        console.log('No saved font size, using default: 100%');
      }
    }
    
    // Load saved font size on page load
    window.loadFontSize();
    console.log('âœ… Font Controls initialized');
    
    // ========== CONSTANTS ==========
    // EXACT SAME LOGIC AS shift-roster.html v8.4
    const START_DATE = new Date(2025, 9, 31); // Oct 31, 2025
    const PATTERN = ['A', 'A', 'N', 'N', 'O', 'O', 'M', 'M'];
    const SHIFT_OFFSETS = {
      'A': 0,
      'B': 4,
      'C': 2,
      'D': 6
    };
    
    // Official Holidays (Kuwait)
    const OFFICIAL_HOLIDAYS = [
      '2026-01-01', // New Year
      '2026-02-25', // National Day
      '2026-02-26', // Liberation Day
      // Add more holidays as needed
    ];
    
    // Calculate vacation days (excluding Fridays and official holidays)
    function calculateVacationDays(startDateStr, endDateStr) {
      const start = new Date(startDateStr + 'T00:00:00');
      const end = new Date(endDateStr + 'T00:00:00');
      
      let totalDays = 0;
      let workDays = 0;
      
      for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
        totalDays++;
        const dateStr = d.toISOString().split('T')[0];
        const dayOfWeek = d.getDay();
        
        // Skip Fridays (5) and official holidays
        if (dayOfWeek !== 5 && !OFFICIAL_HOLIDAYS.includes(dateStr)) {
          workDays++;
        }
      }
      
      return { totalDays, workDays };
    }
    
    // ========== STATE ==========
    let currentUser = null;
    let userShift = '';
    let userLeaves = [];
    let allLeaves = []; // All users' leaves
    let calendarMode = ''; // 'start' or 'end'
    let calendarCurrentMonth = new Date().getMonth();
    let calendarCurrentYear = new Date().getFullYear();
    let testUsers = JSON.parse(localStorage.getItem('vacation_test_users') || '[]');
    
    // ========== SHIFT ROSTER LOGIC ==========
    // EXACT SAME LOGIC AS shift-roster.html v8.4
    function getShiftForDate(date, shift) {
      const diffTime = date - START_DATE;
      const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
      const index = ((diffDays + SHIFT_OFFSETS[shift]) % 8 + 8) % 8;
      return PATTERN[index];
    }
    
    function getShiftType(date, shift) {
      const shiftCode = getShiftForDate(date, shift);
      
      // Check if it's first or second day of the shift
      const prevDate = new Date(date);
      prevDate.setDate(prevDate.getDate() - 1);
      const prevShift = getShiftForDate(prevDate, shift);
      
      const isFirstDay = prevShift !== shiftCode;
      
      const shiftNames = {
        'M': isFirstDay ? 'First Morning' : 'Second Morning',
        'A': isFirstDay ? 'First Afternoon' : 'Second Afternoon',
        'N': isFirstDay ? 'First Night' : 'Second Night',
        'O': 'Off Day'
      };
      
      return {
        code: shiftCode,
        name: shiftNames[shiftCode],
        isFirst: isFirstDay
      };
    }
    
    // ========== UI FUNCTIONS ==========
    function updateShiftInfo() {
      userShift = document.getElementById('userShift').value;
      const leaveSelector = document.getElementById('leaveSelector');
      const leaveForm = document.getElementById('leaveForm');
      
      if (userShift) {
        leaveSelector.style.display = 'block';
        leaveForm.style.display = 'none';
        document.getElementById('leaveNumber').value = '';
      } else {
        leaveSelector.style.display = 'none';
        leaveForm.style.display = 'none';
      }
    }
    
    function selectLeave() {
      const leaveNumber = document.getElementById('leaveNumber').value;
      const leaveForm = document.getElementById('leaveForm');
      
      if (leaveNumber) {
        leaveForm.style.display = 'block';
      } else {
        leaveForm.style.display = 'none';
      }
    }
    
    function checkStartDate() {
      const startDateInput = document.getElementById('startDate');
      const startDateInfo = document.getElementById('startDateInfo');
      
      if (!startDateInput.value || !userShift) return;
      
      // Fix timezone issue
      const [year, month, day] = startDateInput.value.split('-');
      const date = new Date(parseInt(year), parseInt(month) - 1, parseInt(day));
      const shiftInfo = getShiftType(date, userShift);
      
      startDateInfo.style.display = 'block';
      startDateInfo.textContent = `${userShift} Shift - ${shiftInfo.name}`;
      
      // Check if it's First Morning (recommended)
      if (shiftInfo.code === 'M' && shiftInfo.isFirst) {
        startDateInfo.className = 'shift-info';
        startDateInfo.textContent += ' âœ… (Ù…ÙˆØµÙ‰ Ø¨Ù‡)';
      } else if (shiftInfo.code === 'O') {
        startDateInfo.className = 'shift-info warning';
        startDateInfo.textContent += ' âš ï¸ (ÙŠÙˆÙ… Ø±Ø§Ø­Ø©)';
      } else {
        startDateInfo.className = 'shift-info warning';
        startDateInfo.textContent += ' âš ï¸ (ÙŠÙÙØ¶Ù„ Ø§Ù„Ø¨Ø¯Ø¡ Ù…Ù† First Morning)';
      }
    }
    
    function checkEndDate() {
      const endDateInput = document.getElementById('endDate');
      const endDateInfo = document.getElementById('endDateInfo');
      
      if (!endDateInput.value || !userShift) return;
      
      // Fix timezone issue
      const dateParts = endDateInput.value.split('-');
      if (dateParts.length === 3) {
        const [year, month, day] = dateParts;
        const date = new Date(parseInt(year), parseInt(month) - 1, parseInt(day));
        const shiftInfo = getShiftType(date, userShift);
        
        endDateInfo.style.display = 'block';
        endDateInfo.textContent = `${userShift} Shift - ${shiftInfo.name}`;
        
        // Check if it's Second Night (recommended)
        if (shiftInfo.code === 'N' && !shiftInfo.isFirst) {
          endDateInfo.className = 'shift-info';
          endDateInfo.textContent += ' âœ… (Ù…ÙˆØµÙ‰ Ø¨Ù‡)';
        } else if (shiftInfo.code === 'O') {
          endDateInfo.className = 'shift-info warning';
          endDateInfo.textContent += ' âš ï¸ (ÙŠÙˆÙ… Ø±Ø§Ø­Ø©)';
        } else {
          endDateInfo.className = 'shift-info warning';
          endDateInfo.textContent += ' âš ï¸ (ÙŠÙÙØ¶Ù„ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ ÙÙŠ Second Night)';
        }
      }
    }
    
    // ========== CUSTOM CALENDAR ==========
    function openStartCalendar() {
      if (!userShift) {
        alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø´ÙØª Ø£ÙˆÙ„Ø§Ù‹');
        return;
      }
      calendarMode = 'start';
      document.getElementById('calendarTitle').textContent = 'ğŸ“… Ø§Ø®ØªØ± ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©';
      renderCalendar();
      document.getElementById('calendarModal').style.display = 'flex';
    }
    
    function openEndCalendar() {
      if (!userShift) {
        alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø´ÙØª Ø£ÙˆÙ„Ø§Ù‹');
        return;
      }
      calendarMode = 'end';
      document.getElementById('calendarTitle').textContent = 'ğŸ“… Ø§Ø®ØªØ± ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©';
      renderCalendar();
      document.getElementById('calendarModal').style.display = 'flex';
    }
    
    function closeCalendar() {
      document.getElementById('calendarModal').style.display = 'none';
    }
    
    function renderCalendar() {
      const container = document.getElementById('calendarContainer');
      const monthNames = ['ÙŠÙ†Ø§ÙŠØ±', 'ÙØ¨Ø±Ø§ÙŠØ±', 'Ù…Ø§Ø±Ø³', 'Ø£Ø¨Ø±ÙŠÙ„', 'Ù…Ø§ÙŠÙˆ', 'ÙŠÙˆÙ†ÙŠÙˆ', 'ÙŠÙˆÙ„ÙŠÙˆ', 'Ø£ØºØ³Ø·Ø³', 'Ø³Ø¨ØªÙ…Ø¨Ø±', 'Ø£ÙƒØªÙˆØ¨Ø±', 'Ù†ÙˆÙÙ…Ø¨Ø±', 'Ø¯ÙŠØ³Ù…Ø¨Ø±'];
      const weekdays = ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'];
      
      const firstDay = new Date(calendarCurrentYear, calendarCurrentMonth, 1);
      const lastDay = new Date(calendarCurrentYear, calendarCurrentMonth + 1, 0);
      const daysInMonth = lastDay.getDate();
      const startingDayOfWeek = firstDay.getDay();
      
      let html = `
        <div class="custom-calendar">
          <div class="calendar-header">
            <button class="calendar-nav-btn" onclick="prevMonth()">â–¶</button>
            <div class="calendar-month-year">${monthNames[calendarCurrentMonth]} ${calendarCurrentYear}</div>
            <button class="calendar-nav-btn" onclick="nextMonth()">â—€</button>
          </div>
          
          <div class="calendar-weekdays">
            ${weekdays.map(day => `<div class="calendar-weekday">${day}</div>`).join('')}
          </div>
          
          <div class="calendar-days">
      `;
      
      // Empty cells before first day
      for (let i = 0; i < startingDayOfWeek; i++) {
        html += '<div class="calendar-day empty"></div>';
      }
      
      // Days of month
      for (let day = 1; day <= daysInMonth; day++) {
        const date = new Date(calendarCurrentYear, calendarCurrentMonth, day);
        const dateStr = `${calendarCurrentYear}-${String(calendarCurrentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        const shiftInfo = getShiftType(date, userShift);
        const isHoliday = OFFICIAL_HOLIDAYS.includes(dateStr);
        
        const currentValue = calendarMode === 'start' ? document.getElementById('startDate').value : document.getElementById('endDate').value;
        const isSelected = currentValue === dateStr;
        
        html += `
          <div class="calendar-day shift-${shiftInfo.code} ${isSelected ? 'selected' : ''}" onclick="selectDate('${dateStr}')">
            <div class="calendar-day-number">${day}</div>
            <div class="calendar-day-shift">${shiftInfo.name.split(' ')[0]}</div>
            ${isHoliday ? '<div class="calendar-day-holiday"></div>' : ''}
          </div>
        `;
      }
      
      html += `
          </div>
        </div>
      `;
      
      container.innerHTML = html;
    }
    
    function prevMonth() {
      calendarCurrentMonth--;
      if (calendarCurrentMonth < 0) {
        calendarCurrentMonth = 11;
        calendarCurrentYear--;
      }
      renderCalendar();
    }
    
    function nextMonth() {
      calendarCurrentMonth++;
      if (calendarCurrentMonth > 11) {
        calendarCurrentMonth = 0;
        calendarCurrentYear++;
      }
      renderCalendar();
    }
    
    function selectDate(dateStr) {
      if (calendarMode === 'start') {
        document.getElementById('startDate').value = dateStr;
        checkStartDate();
      } else {
        document.getElementById('endDate').value = dateStr;
        checkEndDate();
      }
      closeCalendar();
    }
    
    // ========== DAY DETAILS MODAL ==========
    function showDayDetails(dateStr) {
      const date = new Date(dateStr);
      const dateFormatted = date.toLocaleDateString('ar-EG', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
      
      document.getElementById('modalTitle').textContent = `ğŸ“… ${dateFormatted}`;
      
      // Find people on leave on this day
      const peopleOnLeave = [];
      allLeaves.forEach(leave => {
        const start = new Date(leave.startDate);
        const end = new Date(leave.endDate);
        const checkDate = new Date(dateStr);
        
        if (checkDate >= start && checkDate <= end) {
          peopleOnLeave.push({
            name: leave.userName || leave.userId,
            shift: leave.shift,
            startDate: leave.startDate,
            endDate: leave.endDate
          });
        }
      });
      
      let html = '';
      if (peopleOnLeave.length === 0) {
        html = '<p style="text-align: center; opacity: 0.7;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø­Ø¯ ÙÙŠ Ø¥Ø¬Ø§Ø²Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…</p>';
      } else {
        html = `
          <div style="margin-bottom: 15px;">
            <strong style="color: #4CAF50;">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ø®Ø§Øµ ÙÙŠ Ø¥Ø¬Ø§Ø²Ø©:</strong> ${peopleOnLeave.length}
            ${peopleOnLeave.length >= 4 ? '<span style="color: #f44336; margin-right: 10px;">âš ï¸ ØªØ¹Ø§Ø±Ø¶!</span>' : ''}
          </div>
        `;
        
        peopleOnLeave.forEach(person => {
          html += `
            <div style="
              background: rgba(255,255,255,0.05);
              border: 1px solid rgba(255,255,255,0.2);
              border-radius: 8px;
              padding: 12px;
              margin-bottom: 10px;
            ">
              <div style="font-size: 16px; font-weight: bold; color: #4CAF50; margin-bottom: 5px;">
                ğŸ‘¤ ${person.name}
              </div>
              <div style="font-size: 14px; opacity: 0.9;">
                ğŸ”„ Shift: ${person.shift}
              </div>
              <div style="font-size: 13px; opacity: 0.8; margin-top: 5px;">
                ğŸ“… ${person.startDate} â†’ ${person.endDate}
              </div>
            </div>
          `;
        });
      }
      
      document.getElementById('modalBody').innerHTML = html;
      document.getElementById('dayDetailsModal').style.display = 'flex';
    }
    
    function closeDayDetailsModal() {
      document.getElementById('dayDetailsModal').style.display = 'none';
    }
    
    // ========== TEST MODE ==========
    function toggleTestMode() {
      renderTestMode();
      document.getElementById('testModeModal').style.display = 'flex';
    }
    
    function closeTestMode() {
      document.getElementById('testModeModal').style.display = 'none';
    }
    
    function renderTestMode() {
      const container = document.getElementById('testModeContainer');
      
      let html = `
        <div style="margin-bottom: 20px;">
          <button class="btn btn-primary" onclick="addTestUser()" style="width: 100%;">
            â• Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙ‡Ù…ÙŠ
          </button>
        </div>
      `;
      
      if (testUsers.length === 0) {
        html += '<p style="text-align: center; opacity: 0.7;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆÙ‡Ù…ÙŠÙŠÙ†</p>';
      } else {
        testUsers.forEach((user, index) => {
          html += `
            <div style="
              background: rgba(255,255,255,0.05);
              border: 1px solid rgba(255,255,255,0.2);
              border-radius: 10px;
              padding: 15px;
              margin-bottom: 15px;
            ">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <div>
                  <strong style="color: #4CAF50; font-size: 16px;">ğŸ‘¤ ${user.name}</strong>
                  <span style="margin-right: 10px; opacity: 0.8;">Shift: ${user.shift}</span>
                </div>
                <button onclick="deleteTestUser(${index})" style="
                  background: rgba(244,67,54,0.3);
                  border: 1px solid #f44336;
                  color: white;
                  padding: 5px 10px;
                  border-radius: 5px;
                  cursor: pointer;
                ">ğŸ—‘ï¸ Ø­Ø°Ù</button>
              </div>
              
              <div style="margin-top: 10px;">
                <strong style="color: #4CAF50;">Ø¥Ø¬Ø§Ø²Ø§ØªÙ‡:</strong>
                ${user.leaves.length === 0 ? '<p style="opacity: 0.7; margin: 5px 0;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¬Ø§Ø²Ø§Øª</p>' : ''}
                ${user.leaves.map((leave, leaveIndex) => `
                  <div style="
                    background: rgba(76,175,80,0.1);
                    border: 1px solid rgba(76,175,80,0.3);
                    border-radius: 5px;
                    padding: 8px;
                    margin: 5px 0;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                  ">
                    <span>ğŸ“… ${leave.startDate} â†’ ${leave.endDate}</span>
                    <button onclick="deleteTestLeave(${index}, ${leaveIndex})" style="
                      background: rgba(244,67,54,0.3);
                      border: 1px solid #f44336;
                      color: white;
                      padding: 3px 8px;
                      border-radius: 3px;
                      cursor: pointer;
                      font-size: 12px;
                    ">âŒ</button>
                  </div>
                `).join('')}
                <button onclick="addTestLeave(${index})" style="
                  background: rgba(76,175,80,0.3);
                  border: 1px solid #4CAF50;
                  color: white;
                  padding: 5px 10px;
                  border-radius: 5px;
                  cursor: pointer;
                  margin-top: 5px;
                  width: 100%;
                ">â• Ø¥Ø¶Ø§ÙØ© Ø¥Ø¬Ø§Ø²Ø©</button>
              </div>
            </div>
          `;
        });
      }
      
      html += `
        <div style="margin-top: 20px; text-align: center;">
          <button class="btn btn-secondary" onclick="clearAllTestData()" style="width: 100%;">
            ğŸ—‘ï¸ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆÙ‡Ù…ÙŠØ©
          </button>
        </div>
      `;
      
      container.innerHTML = html;
    }
    
    function addTestUser() {
      const name = prompt('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„ÙˆÙ‡Ù…ÙŠ:');
      if (!name) return;
      
      const shift = prompt('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø´ÙØª (A/B/C/D):');
      if (!shift || !['A', 'B', 'C', 'D'].includes(shift.toUpperCase())) {
        alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø´ÙØª ØµØ­ÙŠØ­ (A/B/C/D)');
        return;
      }
      
      testUsers.push({
        name: name,
        shift: shift.toUpperCase(),
        leaves: []
      });
      
      localStorage.setItem('vacation_test_users', JSON.stringify(testUsers));
      renderTestMode();
      loadAllLeaves(); // Reload to include test users
    }
    
    function deleteTestUser(index) {
      if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ')) {
        testUsers.splice(index, 1);
        localStorage.setItem('vacation_test_users', JSON.stringify(testUsers));
        renderTestMode();
        loadAllLeaves();
      }
    }
    
    function addTestLeave(userIndex) {
      const startDate = prompt('Ø£Ø¯Ø®Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© (YYYY-MM-DD):');
      if (!startDate) return;
      
      const endDate = prompt('Ø£Ø¯Ø®Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ© (YYYY-MM-DD):');
      if (!endDate) return;
      
      testUsers[userIndex].leaves.push({
        startDate: startDate,
        endDate: endDate
      });
      
      localStorage.setItem('vacation_test_users', JSON.stringify(testUsers));
      renderTestMode();
      loadAllLeaves();
    }
    
    function deleteTestLeave(userIndex, leaveIndex) {
      testUsers[userIndex].leaves.splice(leaveIndex, 1);
      localStorage.setItem('vacation_test_users', JSON.stringify(testUsers));
      renderTestMode();
      loadAllLeaves();
    }
    
    function clearAllTestData() {
      if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆÙ‡Ù…ÙŠØ©ØŸ')) {
        testUsers = [];
        localStorage.removeItem('vacation_test_users');
        renderTestMode();
        loadAllLeaves();
      }
    }
    
    async function saveLeave() {
      const startDate = document.getElementById('startDate').value;
      const endDate = document.getElementById('endDate').value;
      
      if (!startDate || !endDate) {
        alert('ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„Ù†Ù‡Ø§ÙŠØ©');
        return;
      }
      
      if (new Date(startDate) > new Date(endDate)) {
        alert('ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù‚Ø¨Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©');
        return;
      }
      
      if (userLeaves.length >= 3) {
        alert('Ù„Ù‚Ø¯ ÙˆØµÙ„Øª Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù…Ù† Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª (3 Ø¥Ø¬Ø§Ø²Ø§Øª)');
        return;
      }
      
      const startShiftInfo = getShiftType(new Date(startDate), userShift);
      const endShiftInfo = getShiftType(new Date(endDate), userShift);
      
      const leave = {
        userId: currentUser.username,
        userName: currentUser.name || currentUser.username,
        shift: userShift,
        startDate: startDate,
        endDate: endDate,
        startShiftType: startShiftInfo.name,
        endShiftType: endShiftInfo.name,
        createdAt: new Date().toISOString()
      };
      
      try {
        // Save to Firestore
        const docRef = await window.addDoc(window.collection(window.db, 'vacations'), leave);
        leave.id = docRef.id;
        
        userLeaves.push(leave);
        renderLeaves();
        resetForm();
        
        alert('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø© Ø¨Ù†Ø¬Ø§Ø­!');
        console.log('âœ… Leave saved to Firestore:', docRef.id);
      } catch (error) {
        console.error('âŒ Error saving leave:', error);
        alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©: ' + error.message);
      }
    }
    
    async function deleteLeave(id) {
      if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©ØŸ')) return;
      
      try {
        // Delete from Firestore: vacations/{docId}
        await window.deleteDoc(window.doc(window.db, 'vacations', id));
        
        // Also delete from Test Mode localStorage if exists
        testUsers = testUsers.map(user => {
          if (user.leaves) {
            user.leaves = user.leaves.filter(l => l.id !== id);
          }
          return user;
        });
        localStorage.setItem('vacation_test_users', JSON.stringify(testUsers));
        
        // Remove from local array
        userLeaves = userLeaves.filter(l => l.id !== id);
        renderLeaves();
        
        // Reload all leaves to update annual roster
        await loadAllLeaves();
        
        alert('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¥Ø¬Ø§Ø²Ø© Ø¨Ù†Ø¬Ø§Ø­!');
        console.log('âœ… Leave deleted from Firestore:', id);
      } catch (error) {
        console.error('âŒ Error deleting leave:', error);
        alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©: ' + error.message);
      }
    }
    
    function renderLeaves() {
      const container = document.getElementById('leavesContainer');
      
      if (userLeaves.length === 0) {
        container.innerHTML = '<p style="text-align: center; opacity: 0.7;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¬Ø§Ø²Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©</p>';
        return;
      }
      
      container.innerHTML = userLeaves.map(leave => {
        const days = calculateVacationDays(leave.startDate, leave.endDate);
        return `
        <div class="leave-item">
          <div class="leave-info">
            <div class="leave-dates">
              ğŸ“… ${leave.startDate} â†’ ${leave.endDate}
            </div>
            <div class="leave-shift-type">
              ${leave.shift} Shift: ${leave.startShiftType} â†’ ${leave.endShiftType}
            </div>
            <div class="leave-days" style="font-size: 12px; color: #4CAF50; margin-top: 5px;">
              ğŸ“† ${days.workDays} ÙŠÙˆÙ… Ø¹Ù…Ù„ (Ù…Ù† ${days.totalDays} ÙŠÙˆÙ… Ø¥Ø¬Ù…Ø§Ù„ÙŠ)
            </div>
          </div>
          <button class="btn btn-danger delete-leave-btn" data-id="${leave.id}" style="padding: 8px 16px; font-size: 14px;">
            ğŸ—‘ï¸ Ø­Ø°Ù
          </button>
        </div>
      `}).join('');
      
      // Add event listeners to delete buttons
      document.querySelectorAll('.delete-leave-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const leaveId = btn.getAttribute('data-id');
          deleteLeave(leaveId);
        });
      });
    }
    
    function resetForm() {
      document.getElementById('startDate').value = '';
      document.getElementById('endDate').value = '';
      document.getElementById('startDateInfo').style.display = 'none';
      document.getElementById('endDateInfo').style.display = 'none';
    }
    
    // ========== LOGOUT ==========
    function handleLogout() {
      if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) {
        if (window.auth && window.auth.signOut) {
          window.auth.signOut().then(() => {
            localStorage.removeItem('tanktools_current_user');
            sessionStorage.removeItem('tanktools_session');
            window.location.href = 'login.html';
          });
        } else {
          localStorage.removeItem('tanktools_current_user');
          sessionStorage.removeItem('tanktools_session');
          window.location.href = 'login.html';
        }
      }
    }
    
    // ========== LOAD USER LEAVES ==========
    async function loadUserLeaves() {
      if (!currentUser) return;
      
      try {
        const q = window.query(
          window.collection(window.db, 'vacations'),
          window.where('userId', '==', currentUser.username)
        );
        
        const querySnapshot = await window.getDocs(q);
        userLeaves = [];
        
        querySnapshot.forEach((doc) => {
          userLeaves.push({
            id: doc.id,
            ...doc.data()
          });
        });
        
        renderLeaves();
        console.log('âœ… Loaded', userLeaves.length, 'leaves from Firestore');
      } catch (error) {
        console.error('âŒ Error loading leaves:', error);
      }
    }
    
    // ========== LOAD ALL LEAVES ==========
    async function loadAllLeaves() {
      try {
        const querySnapshot = await window.getDocs(window.collection(window.db, 'vacations'));
        allLeaves = [];
        
        querySnapshot.forEach((doc) => {
          allLeaves.push({
            id: doc.id,
            ...doc.data()
          });
        });
        
        // Add test users' leaves
        testUsers.forEach(user => {
          user.leaves.forEach(leave => {
            allLeaves.push({
              userId: `test_${user.name}`,
              userName: `ğŸ§ª ${user.name}`,
              shift: user.shift,
              startDate: leave.startDate,
              endDate: leave.endDate,
              isTest: true
            });
          });
        });
        
        console.log('âœ… Loaded', allLeaves.length, 'total leaves (including test users)');
        renderAnnualRoster();
      } catch (error) {
        console.error('âŒ Error loading all leaves:', error);
      }
    }
    
    // ========== ANNUAL ROSTER ==========
    function renderAnnualRoster() {
      const year = parseInt(document.getElementById('rosterYear').value);
      const grid = document.getElementById('annualRosterGrid');
      const suggestions = document.getElementById('conflictSuggestions');
      
      // Count people on leave for each day
      const dailyCounts = {};
      const dailyPeople = {};
      
      allLeaves.forEach(leave => {
        const start = new Date(leave.startDate);
        const end = new Date(leave.endDate);
        
        // Iterate through each day of the leave
        for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
          if (d.getFullYear() === year) {
            const dateStr = d.toISOString().split('T')[0];
            dailyCounts[dateStr] = (dailyCounts[dateStr] || 0) + 1;
            
            if (!dailyPeople[dateStr]) dailyPeople[dateStr] = [];
            dailyPeople[dateStr].push(leave.userName || leave.userId);
          }
        }
      });
      
      // Find conflicts (4+ people)
      const conflicts = Object.entries(dailyCounts)
        .filter(([date, count]) => count >= 4)
        .sort((a, b) => new Date(a[0]) - new Date(b[0]));
      
      // Render calendar grid (12 months)
      let html = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; margin-top: 20px;">';
      
      for (let month = 0; month < 12; month++) {
        const monthDate = new Date(year, month, 1);
        const monthName = monthDate.toLocaleDateString('ar-EG', { month: 'long' });
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        
        html += `
          <div style="background: rgba(255,255,255,0.05); border-radius: 10px; padding: 15px;">
            <h3 style="text-align: center; color: #4CAF50; margin-bottom: 10px; font-size: 16px;">${monthName} ${year}</h3>
            <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px;">
        `;
        
        // Day headers
        ['S', 'M', 'T', 'W', 'T', 'F', 'S'].forEach(day => {
          html += `<div style="text-align: center; font-size: 12px; font-weight: bold; opacity: 0.7;">${day}</div>`;
        });
        
        // Empty cells before month starts
        const firstDay = new Date(year, month, 1).getDay();
        for (let i = 0; i < firstDay; i++) {
          html += '<div></div>';
        }
        
        // Days of month
        for (let day = 1; day <= daysInMonth; day++) {
          const date = new Date(year, month, day);
          const dateStr = date.toISOString().split('T')[0];
          const count = dailyCounts[dateStr] || 0;
          
          let bgColor = 'rgba(255,255,255,0.05)';
          let textColor = '#fff';
          
          if (count >= 4) {
            bgColor = 'rgba(244,67,54,0.4)';
            textColor = '#fff';
          } else if (count === 3) {
            bgColor = 'rgba(255,152,0,0.4)';
            textColor = '#fff';
          } else if (count > 0) {
            bgColor = 'rgba(76,175,80,0.3)';
            textColor = '#fff';
          }
          
          const title = count > 0 ? `${count} Ø£Ø´Ø®Ø§Øµ: ${dailyPeople[dateStr].join(', ')}` : '';
          
          html += `
            <div style="
              background: ${bgColor};
              border-radius: 4px;
              padding: 8px 4px;
              text-align: center;
              font-size: 12px;
              color: ${textColor};
              cursor: ${count > 0 ? 'pointer' : 'default'};
              border: ${count >= 4 ? '2px solid #f44336' : count === 3 ? '1px solid #FF9800' : 'none'};
            " title="${title}" ${count > 0 ? `onclick="showDayDetails('${dateStr}')"` : ''}>
              ${day}${count > 0 ? `<br><span style="font-size: 10px;">(${count})</span>` : ''}
            </div>
          `;
        }
        
        html += '</div></div>';
      }
      
      html += '</div>';
      grid.innerHTML = html;
      
      // Render conflict suggestions with merged consecutive days
      if (conflicts.length > 0) {
        // Group consecutive days with same people
        const mergedConflicts = [];
        let currentGroup = null;
        
        conflicts.forEach(([date, count]) => {
          const people = dailyPeople[date].sort().join(',');
          const dateObj = new Date(date);
          
          if (!currentGroup) {
            currentGroup = {
              startDate: dateObj,
              endDate: dateObj,
              count: count,
              people: dailyPeople[date]
            };
          } else {
            // Check if consecutive day with same people
            const prevDate = new Date(currentGroup.endDate);
            prevDate.setDate(prevDate.getDate() + 1);
            const currentPeople = currentGroup.people.sort().join(',');
            
            if (dateObj.getTime() === prevDate.getTime() && people === currentPeople) {
              // Extend current group
              currentGroup.endDate = dateObj;
            } else {
              // Start new group
              mergedConflicts.push(currentGroup);
              currentGroup = {
                startDate: dateObj,
                endDate: dateObj,
                count: count,
                people: dailyPeople[date]
              };
            }
          }
        });
        
        if (currentGroup) {
          mergedConflicts.push(currentGroup);
        }
        
        let suggestionsHtml = `
          <div class="alert alert-error">
            <h3 style="margin-bottom: 15px;">ğŸ”´ ØªØ¹Ø§Ø±Ø¶Ø§Øª Ù…ÙƒØªØ´ÙØ© (${mergedConflicts.length} ÙØªØ±Ø©)</h3>
        `;
        
        mergedConflicts.forEach(conflict => {
          const startStr = conflict.startDate.toLocaleDateString('ar-EG', { day: 'numeric', month: 'long' });
          const endStr = conflict.endDate.toLocaleDateString('ar-EG', { day: 'numeric', month: 'long', year: 'numeric' });
          const isSameDay = conflict.startDate.getTime() === conflict.endDate.getTime();
          const dateRange = isSameDay ? endStr : `${startStr} - ${endStr}`;
          const peopleList = conflict.people.join(' â€¢ ');
          
          suggestionsHtml += `
            <div style="
              background: rgba(244,67,54,0.1);
              border: 1px solid rgba(244,67,54,0.3);
              border-radius: 8px;
              padding: 12px;
              margin-bottom: 10px;
            ">
              <div style="font-size: 15px; font-weight: bold; color: #f44336; margin-bottom: 8px;">
                ğŸ“… ${dateRange}
              </div>
              <div style="font-size: 14px; margin-bottom: 5px;">
                âš ï¸ ØªØ¹Ø§Ø±Ø¶: <strong>${conflict.count} Ø£Ø´Ø®Ø§Øµ</strong>
              </div>
              <div style="font-size: 13px; opacity: 0.9;">
                ğŸ‘¥ ${peopleList}
              </div>
            </div>
          `;
        });
        
        suggestionsHtml += `
            <p style="margin-top: 15px; font-size: 14px; background: rgba(255,152,0,0.1); padding: 10px; border-radius: 5px;">
              ğŸ’¡ <strong>Ù†ØµÙŠØ­Ø©:</strong> ÙŠØ±Ø¬Ù‰ Ù…Ù† Ø£Ø­Ø¯ Ø§Ù„Ø£Ø´Ø®Ø§Øµ ØªØºÙŠÙŠØ± ØªØ§Ø±ÙŠØ® Ø¥Ø¬Ø§Ø²ØªÙ‡ Ù„ØªØ¬Ù†Ø¨ Ø§Ù„ØªØ¹Ø§Ø±Ø¶.
            </p>
          </div>
        `;
        
        suggestions.innerHTML = suggestionsHtml;
      } else {
        suggestions.innerHTML = `
          <div class="alert alert-success">
            âœ… Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¹Ø§Ø±Ø¶Ø§Øª! Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª Ù…ØªÙˆØ§ÙÙ‚Ø©.
          </div>
        `;
      }
    }
    
    // ========== THEME FUNCTIONS ==========
    function toggleThemeDropdown() {
      const dropdown = document.getElementById('themeDropdown');
      dropdown.classList.toggle('show');
    }
    
    function setTheme(theme, closeDropdown = true) {
      document.documentElement.setAttribute('data-theme', theme);
      localStorage.setItem('theme', theme);
      
      // Update active theme option
      document.querySelectorAll('.theme-option').forEach(opt => {
        opt.classList.remove('active');
        if (opt.getAttribute('data-theme') === theme) {
          opt.classList.add('active');
        }
      });
      
      if (closeDropdown) {
        toggleThemeDropdown();
      }
    }
    
    // Load saved theme on page load
    window.addEventListener('DOMContentLoaded', function() {
      const savedTheme = localStorage.getItem('theme') || 'industrial';
      document.documentElement.setAttribute('data-theme', savedTheme);
      
      // Mark active theme in dropdown
      setTimeout(() => {
        document.querySelectorAll('.theme-option').forEach(opt => {
          if (opt.getAttribute('data-theme') === savedTheme) {
            opt.classList.add('active');
          }
        });
      }, 100);
    });
    
    // Close dropdown when clicking outside
    document.addEventListener('click', function(e) {
      const themeSwitcher = document.querySelector('.theme-switcher');
      if (themeSwitcher && !themeSwitcher.contains(e.target)) {
        const dropdown = document.getElementById('themeDropdown');
        if (dropdown) dropdown.classList.remove('show');
      }
    });
    
    // ========== INITIALIZE ==========
    console.log('%cğŸ–ï¸ VACATION PLANNER v2.8 - Using Firebase Auth Handler', 'color:#4CAF50;font-size:20px;font-weight:bold');
    console.log('%cDeveloper: Fahad - 17877', 'color:green;font-size:16px');
  </script>
  
  <!-- Firebase Auth Handler -->
  <script src="firebase-auth-handler.js" type="module"></script>
  <script type="module">
    import FirebaseAuthHandler from './firebase-auth-handler.js';
    import { getFirestore, doc, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    // âœ… Initialize Firebase Auth Handler
    FirebaseAuthHandler.init({
      pageName: 'Vacation Planner',
      redirectPage: 'index.html',
      checkPermissions: true
    });
    
    // Import additional Firestore functions
    import { collection, getDocs, addDoc, deleteDoc, query, where } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
    window.collection = collection;
    window.getDocs = getDocs;
    window.addDoc = addDoc;
    window.deleteDoc = deleteDoc;
    window.query = query;
    window.where = where;
    
    console.log('%cğŸ–ï¸ VACATION PLANNER v2.8 - Using Firebase Auth Handler', 'color:#4CAF50;font-size:16px;font-weight:bold');
    console.log('%cDeveloper: Fahad - 17877', 'color:green;font-size:14px');
    
    // âœ… Wait for FirebaseAuthHandler to set currentUser
    const checkUserInterval = setInterval(async () => {
      if (window.currentUser) {
        clearInterval(checkUserInterval);
        currentUser = window.currentUser;
        
        // Update UI with user name
        const userNameEl = document.getElementById('userName');
        if (userNameEl) {
          userNameEl.textContent = window.currentUser.name || window.currentUser.username;
        }
        
        // Update user avatar with first letter
        const avatarElement = document.getElementById('userAvatar');
        if (avatarElement) {
          const firstLetter = (window.currentUser.name || window.currentUser.username || 'U').charAt(0).toUpperCase();
          avatarElement.textContent = firstLetter;
        }
        
        console.log('âœ… Vacation Planner loaded for:', window.currentUser.name);
        
        // Load user leaves
        await loadUserLeaves();
        
        // Load all leaves for annual roster
        await loadAllLeaves();
      }
    }, 100);
    
    setTimeout(() => {
      clearInterval(checkUserInterval);
      if (!window.currentUser) {
        console.error('âŒ Failed to load user data');
      }
    }, 5000);
  </script>
  <script src="pwa-install-banner.js"></script>
</body>
</html>
