<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام المنبه المباشر</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: white;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #FFD700, #FFA500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .alarm-form {
            background: rgba(255, 255, 255, 0.05);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #FFD700;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-size: 16px;
        }
        
        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .time-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 5px;
            min-width: 200px;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
        }
        
        .btn-secondary {
            background: linear-gradient(45deg, #2196F3, #1976D2);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(45deg, #FF9800, #F57C00);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .platform-detection {
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .status-message {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
        }
        
        .success { background: rgba(76, 175, 80, 0.2); border-left: 4px solid #4CAF50; }
        .error { background: rgba(244, 67, 54, 0.2); border-left: 4px solid #F44336; }
        .info { background: rgba(33, 150, 243, 0.2); border-left: 4px solid #2196F3; }
        .warning { background: rgba(255, 152, 0, 0.2); border-left: 4px solid #FF9800; }
        
        .quick-times {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }
        
        .quick-time-btn {
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .quick-time-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }
        
        .alarm-preview {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        @media (max-width: 768px) {
            .time-inputs {
                grid-template-columns: 1fr;
            }
            
            .btn {
                width: 100%;
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>⏰ منبه الجوال المباشر</h1>
            <p>يفتح تطبيق المنبه في جوالك مباشرة!</p>
        </div>

        <div class="platform-detection" id="platformInfo">
            <h3>🔍 اكتشاف نوع الجهاز...</h3>
            <p id="deviceType">جاري الفحص...</p>
        </div>

        <div class="alarm-form">
            <h3>🚨 إعداد المنبه</h3>
            
            <div class="form-group">
                <label class="form-label">📝 عنوان المنبه:</label>
                <input type="text" id="alarmTitle" class="form-input" placeholder="مثال: تبديل المناوبة" value="تنبيه عمل مهم">
            </div>
            
            <div class="form-group">
                <label class="form-label">📋 تفاصيل إضافية:</label>
                <textarea id="alarmDescription" class="form-textarea" placeholder="أي تفاصيل إضافية للمنبه..."></textarea>
            </div>
            
            <div class="form-group">
                <label class="form-label">⏰ وقت المنبه:</label>
                <div class="time-inputs">
                    <input type="time" id="alarmTime" class="form-input">
                    <input type="date" id="alarmDate" class="form-input">
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">🔔 نوع المنبه:</label>
                <select id="alarmType" class="form-select">
                    <option value="normal">عادي</option>
                    <option value="important">مهم</option>
                    <option value="urgent">عاجل</option>
                    <option value="critical">حرج</option>
                </select>
            </div>

            <h4>⚡ أوقات سريعة:</h4>
            <div class="quick-times">
                <button class="quick-time-btn" onclick="setQuickTime(5)">بعد 5 دقائق</button>
                <button class="quick-time-btn" onclick="setQuickTime(15)">بعد 15 دقيقة</button>
                <button class="quick-time-btn" onclick="setQuickTime(30)">بعد 30 دقيقة</button>
                <button class="quick-time-btn" onclick="setQuickTime(60)">بعد ساعة</button>
            </div>

            <div class="alarm-preview" id="alarmPreview" style="display: none;">
                <h4>📋 معاينة المنبه:</h4>
                <div id="previewContent"></div>
            </div>
        </div>

        <div style="text-align: center;">
            <button class="btn btn-primary" onclick="createNativeAlarm()">
                📱 فتح منبه الجوال
            </button>
            
            <button class="btn btn-secondary" onclick="createCalendarEvent()">
                📅 إضافة للتقويم
            </button>
            
            <button class="btn btn-warning" onclick="testAlarmMethods()">
                🔧 اختبار جميع الطرق
            </button>
            
            <button class="btn btn-secondary" onclick="tryManualDeepLinks()">
                🔗 تجربة روابط يدوية
            </button>
        </div>

        <div id="statusMessages"></div>
        
        <div style="margin-top: 30px; padding: 20px; background: rgba(0,0,0,0.2); border-radius: 10px;">
            <h4>📖 طريقة الاستخدام:</h4>
            <ol style="text-align: right; line-height: 1.8;">
                <li>أدخل عنوان المنبه والوقت المطلوب</li>
                <li>اختر نوع المنبه (عادي أو مهم أو عاجل)</li>
                <li>اضغط "فتح منبه الجوال" - سيفتح تطبيق المنبه مباشرة</li>
                <li>أكمل إعداد المنبه في التطبيق واحفظه</li>
                <li>المنبه سيعمل حتى لو كان الجوال مقفل!</li>
            </ol>
        </div>
    </div>

    <script>
        // كشف نوع الجهاز
        function detectDevice() {
            const userAgent = navigator.userAgent.toLowerCase();
            const platform = navigator.platform.toLowerCase();
            
            let deviceInfo = {
                type: 'unknown',
                os: 'unknown',
                browser: 'unknown',
                canUseDeepLinks: false
            };
            
            // كشف iOS
            if (/iphone|ipad|ipod/.test(userAgent) || (platform.includes('mac') && 'ontouchend' in document)) {
                deviceInfo.type = 'iOS';
                deviceInfo.os = 'iOS';
                deviceInfo.canUseDeepLinks = true;
            }
            // كشف Android  
            else if (/android/.test(userAgent)) {
                deviceInfo.type = 'Android';
                deviceInfo.os = 'Android';
                deviceInfo.canUseDeepLinks = true;
            }
            // كشف Windows
            else if (/windows/.test(userAgent)) {
                deviceInfo.type = 'Desktop';
                deviceInfo.os = 'Windows';
                deviceInfo.canUseDeepLinks = false;
            }
            // كشف Mac
            else if (/mac/.test(userAgent)) {
                deviceInfo.type = 'Desktop';
                deviceInfo.os = 'macOS';
                deviceInfo.canUseDeepLinks = false;
            }
            
            // كشف المتصفح
            if (/chrome/.test(userAgent)) deviceInfo.browser = 'Chrome';
            else if (/safari/.test(userAgent)) deviceInfo.browser = 'Safari';
            else if (/firefox/.test(userAgent)) deviceInfo.browser = 'Firefox';
            else if (/edge/.test(userAgent)) deviceInfo.browser = 'Edge';
            
            return deviceInfo;
        }
        
        // عرض معلومات الجهاز
        function displayDeviceInfo() {
            const device = detectDevice();
            const platformDiv = document.getElementById('platformInfo');
            const deviceTypeSpan = document.getElementById('deviceType');
            
            let statusColor = device.canUseDeepLinks ? '#4CAF50' : '#FF9800';
            let statusText = device.canUseDeepLinks ? '✅ مدعوم' : '⚠️ محدود';
            
            deviceTypeSpan.innerHTML = `
                <strong>نوع الجهاز:</strong> ${device.type}<br>
                <strong>نظام التشغيل:</strong> ${device.os}<br>
                <strong>المتصفح:</strong> ${device.browser}<br>
                <strong style="color: ${statusColor};">فتح التطبيقات: ${statusText}</strong>
            `;
            
            return device;
        }
        
        // تعيين وقت سريع
        function setQuickTime(minutes) {
            const now = new Date();
            const futureTime = new Date(now.getTime() + minutes * 60000);
            
            document.getElementById('alarmTime').value = futureTime.toTimeString().slice(0, 5);
            document.getElementById('alarmDate').value = futureTime.toISOString().slice(0, 10);
            
            updateAlarmPreview();
            showMessage(`تم تعيين المنبه بعد ${minutes} دقيقة`, 'success');
        }
        
        // تحديث معاينة المنبه
        function updateAlarmPreview() {
            const title = document.getElementById('alarmTitle').value;
            const time = document.getElementById('alarmTime').value;
            const date = document.getElementById('alarmDate').value;
            const type = document.getElementById('alarmType').value;
            
            if (title && time && date) {
                const alarmDateTime = new Date(`${date}T${time}`);
                const now = new Date();
                const diff = alarmDateTime - now;
                
                let timeUntil = '';
                if (diff > 0) {
                    const hours = Math.floor(diff / (1000 * 60 * 60));
                    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                    timeUntil = `بعد ${hours} ساعة و ${minutes} دقيقة`;
                } else {
                    timeUntil = 'في الماضي ⚠️';
                }
                
                const typeIcons = {
                    normal: '🔵',
                    important: '🟡', 
                    urgent: '🔴',
                    critical: '🚨'
                };
                
                document.getElementById('previewContent').innerHTML = `
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px;">
                        <p><strong>${typeIcons[type]} ${title}</strong></p>
                        <p>📅 ${alarmDateTime.toLocaleDateString('ar-SA')}</p>
                        <p>⏰ ${alarmDateTime.toLocaleTimeString('ar-SA')}</p>
                        <p>⏳ ${timeUntil}</p>
                    </div>
                `;
                
                document.getElementById('alarmPreview').style.display = 'block';
            } else {
                document.getElementById('alarmPreview').style.display = 'none';
            }
        }
        
        // إنشاء منبه في التطبيق الأصلي
        function createNativeAlarm() {
            const device = detectDevice();
            const title = document.getElementById('alarmTitle').value;
            const time = document.getElementById('alarmTime').value;
            const date = document.getElementById('alarmDate').value;
            const description = document.getElementById('alarmDescription').value;
            
            if (!title || !time || !date) {
                showMessage('يرجى ملء جميع الحقول المطلوبة', 'error');
                return;
            }
            
            const alarmDateTime = new Date(`${date}T${time}`);
            const hours = alarmDateTime.getHours();
            const minutes = alarmDateTime.getMinutes();
            
            // محاولة عدة طرق متتالية
            showMessage('🔄 جاري محاولة فتح تطبيق المنبه...', 'info');
            
            if (device.type === 'iOS') {
                tryiOSAlarmMethods(title, alarmDateTime, hours, minutes);
            } else if (device.type === 'Android') {
                tryAndroidAlarmMethods(title, alarmDateTime, hours, minutes);
            } else {
                showMessage('هذا الجهاز لا يدعم فتح تطبيقات الجوال. جرب "إضافة للتقويم" بدلاً من ذلك', 'warning');
                return;
            }
        }
        
        // محاولة طرق iOS متعددة
        function tryiOSAlarmMethods(title, dateTime, hours, minutes) {
            const methods = [
                // الطريقة الأساسية - Clock App
                `clock-alarm://new?at=${dateTime.toISOString()}&label=${encodeURIComponent(title)}`,
                // طرق أخرى
                `clock://`,
                `x-apple-clock://alarm`,
                `prefs:root=SOUNDS&path=Ringtone`,
                // Shortcuts app
                `shortcuts://run-shortcut?name=CreateAlarm&input=${encodeURIComponent(title)}`
            ];
            
            let currentMethod = 0;
            
            function tryNextMethod() {
                if (currentMethod >= methods.length) {
                    // فشلت كل الطرق
                    showMessage('لم يتم العثور على تطبيق منبه متوافق. سنعرض التعليمات اليدوية', 'warning');
                    showAlarmInstructions(title, dateTime);
                    return;
                }
                
                const deepLink = methods[currentMethod];
                showMessage(`🔄 المحاولة ${currentMethod + 1}/${methods.length}: ${getMethodName(deepLink)}`, 'info');
                
                // محاولة فتح Deep Link
                const link = document.createElement('a');
                link.href = deepLink;
                link.style.display = 'none';
                document.body.appendChild(link);
                
                // مراقب النجاح
                const startTime = Date.now();
                const successTimer = setTimeout(() => {
                    const elapsed = Date.now() - startTime;
                    if (elapsed >= 1500) {
                        // نجح في الفتح (المتصفح توقف لفترة)
                        showMessage('✅ تم فتح التطبيق! أكمل إعداد المنبه واحفظه', 'success');
                        document.body.removeChild(link);
                        return;
                    }
                }, 1500);
                
                // مراقب الفشل
                const failTimer = setTimeout(() => {
                    clearTimeout(successTimer);
                    document.body.removeChild(link);
                    currentMethod++;
                    setTimeout(tryNextMethod, 500); // تأخير قصير بين المحاولات
                }, 800);
                
                // إضافة مستمع لتغيير صفحة (يعني نجح الفتح)
                const visibilityHandler = () => {
                    if (document.visibilityState === 'hidden') {
                        clearTimeout(failTimer);
                        clearTimeout(successTimer);
                        showMessage('✅ تم فتح التطبيق! أكمل إعداد المنبه واحفظه', 'success');
                        document.removeEventListener('visibilitychange', visibilityHandler);
                        if (link.parentNode) document.body.removeChild(link);
                    }
                };
                document.addEventListener('visibilitychange', visibilityHandler);
                
                // محاولة فتح الرابط
                try {
                    link.click();
                } catch (error) {
                    clearTimeout(successTimer);
                    clearTimeout(failTimer);
                    document.removeEventListener('visibilitychange', visibilityHandler);
                    if (link.parentNode) document.body.removeChild(link);
                    currentMethod++;
                    setTimeout(tryNextMethod, 500);
                }
            }
            
            tryNextMethod();
        }
        
        // محاولة طرق Android متعددة  
        function tryAndroidAlarmMethods(title, dateTime, hours, minutes) {
            const methods = [
                // Google Clock
                `intent://alarm?hour=${hours}&minutes=${minutes}&message=${encodeURIComponent(title)}#Intent;scheme=android.intent.action.SET_ALARM;package=com.google.android.deskclock;end`,
                // Samsung Clock
                `intent://alarm?hour=${hours}&minutes=${minutes}&message=${encodeURIComponent(title)}#Intent;scheme=android.intent.action.SET_ALARM;package=com.samsung.android.app.clockpackage;end`,
                // AOSP Clock
                `intent://alarm?hour=${hours}&minutes=${minutes}&message=${encodeURIComponent(title)}#Intent;scheme=android.intent.action.SET_ALARM;package=com.android.deskclock;end`,
                // Standard Android Alarm Intent
                `intent://alarm#Intent;action=android.intent.action.SET_ALARM;i.android.intent.extra.alarm.HOUR=${hours};i.android.intent.extra.alarm.MINUTES=${minutes};S.android.intent.extra.alarm.MESSAGE=${encodeURIComponent(title)};end`,
                // Alternative format
                `android-app://com.google.android.deskclock/alarm?hour=${hours}&minutes=${minutes}&message=${encodeURIComponent(title)}`,
                // Generic alarm action
                `intent:#Intent;action=android.intent.action.SET_ALARM;i.android.intent.extra.alarm.HOUR=${hours};i.android.intent.extra.alarm.MINUTES=${minutes};S.android.intent.extra.alarm.MESSAGE=${title};end`
            ];
            
            let currentMethod = 0;
            
            function tryNextMethod() {
                if (currentMethod >= methods.length) {
                    // فشلت كل الطرق
                    showMessage('لم يتم العثور على تطبيق منبه متوافق. سنعرض التعليمات اليدوية', 'warning');
                    showAlarmInstructions(title, dateTime);
                    return;
                }
                
                const deepLink = methods[currentMethod];
                showMessage(`🔄 المحاولة ${currentMethod + 1}/${methods.length}: ${getAndroidMethodName(deepLink)}`, 'info');
                
                // محاولة فتح Deep Link مع iframe بدلاً من رابط
                const iframe = document.createElement('iframe');
                iframe.style.display = 'none';
                iframe.src = deepLink;
                document.body.appendChild(iframe);
                
                // مراقب النجاح/الفشل
                let resolved = false;
                
                const cleanup = () => {
                    if (iframe.parentNode) {
                        document.body.removeChild(iframe);
                    }
                };
                
                // مراقب النجاح - إذا اختفت الصفحة يعني نجح
                const visibilityHandler = () => {
                    if (!resolved && document.visibilityState === 'hidden') {
                        resolved = true;
                        showMessage('✅ تم فتح التطبيق! أكمل إعداد المنبه واحفظه', 'success');
                        cleanup();
                        document.removeEventListener('visibilitychange', visibilityHandler);
                    }
                };
                document.addEventListener('visibilitychange', visibilityHandler);
                
                // مراقب الفشل
                setTimeout(() => {
                    if (!resolved) {
                        resolved = true;
                        document.removeEventListener('visibilitychange', visibilityHandler);
                        cleanup();
                        currentMethod++;
                        
                        if (currentMethod < methods.length) {
                            setTimeout(tryNextMethod, 800);
                        } else {
                            showMessage('لم يتم العثور على تطبيق منبه متوافق. سنعرض التعليمات اليدوية', 'warning');
                            showAlarmInstructions(title, dateTime);
                        }
                    }
                }, 2000);
                
                // محاولة أيضاً بطريقة window.location كنسخة احتياطية
                setTimeout(() => {
                    if (!resolved) {
                        try {
                            window.location.href = deepLink;
                        } catch (e) {
                            console.log('Window location method failed:', e);
                        }
                    }
                }, 500);
            }
            
            tryNextMethod();
        }
        
        // الحصول على اسم الطريقة
        function getMethodName(url) {
            if (url.includes('clock-alarm://')) return 'تطبيق الساعة الأساسي';
            if (url.includes('clock://')) return 'تطبيق الساعة العام';
            if (url.includes('shortcuts://')) return 'تطبيق الاختصارات';
            if (url.includes('prefs:')) return 'إعدادات النظام';
            return 'طريقة غير معروفة';
        }
        
        function getAndroidMethodName(url) {
            if (url.includes('com.google.android.deskclock')) return 'Google Clock';
            if (url.includes('com.samsung.android.app.clockpackage')) return 'Samsung Clock';
            if (url.includes('com.android.deskclock')) return 'Android Clock';
            if (url.includes('android-app://')) return 'Android App Link';
            return 'Android Standard Intent';
        }
        
        // عرض تعليمات المنبه اليدوي
        function showAlarmInstructions(title, dateTime) {
            const instructions = `
                <div style="background: rgba(255,152,0,0.2); padding: 20px; border-radius: 10px; margin: 15px 0;">
                    <h4>📱 تعليمات الإعداد اليدوي:</h4>
                    <ol style="text-align: right; line-height: 2;">
                        <li>افتح تطبيق الساعة في جوالك</li>
                        <li>اذهب إلى تبويب "المنبه" أو "Alarm"</li>
                        <li>اضغط "+" لإضافة منبه جديد</li>
                        <li>اضبط الوقت: ${dateTime.toLocaleTimeString('ar-SA')}</li>
                        <li>اضبط التاريخ: ${dateTime.toLocaleDateString('ar-SA')}</li>
                        <li>أضف العنوان: ${title}</li>
                        <li>احفظ المنبه</li>
                    </ol>
                </div>
            `;
            
            document.getElementById('statusMessages').innerHTML += instructions;
        }
        
        // إنشاء حدث تقويم
        function createCalendarEvent() {
            const title = document.getElementById('alarmTitle').value;
            const time = document.getElementById('alarmTime').value;
            const date = document.getElementById('alarmDate').value;
            const description = document.getElementById('alarmDescription').value;
            const type = document.getElementById('alarmType').value;
            
            if (!title || !time || !date) {
                showMessage('يرجى ملء جميع الحقول المطلوبة', 'error');
                return;
            }
            
            const alarmDateTime = new Date(`${date}T${time}`);
            const endDateTime = new Date(alarmDateTime.getTime() + 5 * 60000); // 5 دقائق
            
            // تحديد عدد التنبيهات حسب النوع
            const alertSettings = {
                normal: ['-PT0M'],
                important: ['-PT0M', '-PT5M'],
                urgent: ['-PT0M', '-PT5M', '-PT15M'],
                critical: ['-PT0M', '-PT1M', '-PT5M', '-PT15M']
            };
            
            const alerts = alertSettings[type].map(trigger => `
BEGIN:VALARM
TRIGGER:${trigger}
ACTION:DISPLAY
DESCRIPTION:${title}
END:VALARM
BEGIN:VALARM
TRIGGER:${trigger}
ACTION:AUDIO
ATTACH;VALUE=URI:Alarm
END:VALARM`).join('\n');
            
            const icsContent = `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Tank Tools//Work Alarm//EN
CALSCALE:GREGORIAN
METHOD:PUBLISH
BEGIN:VEVENT
UID:${Date.now()}@tanktools.work
DTSTART:${formatICS(alarmDateTime)}
DTEND:${formatICS(endDateTime)}
SUMMARY:🚨 ${title}
DESCRIPTION:تنبيه عمل - ${type.toUpperCase()}\\n\\n${description}
CATEGORIES:WORK,ALARM,${type.toUpperCase()}
STATUS:CONFIRMED
TRANSP:OPAQUE
PRIORITY:${type === 'critical' ? 1 : type === 'urgent' ? 3 : type === 'important' ? 5 : 9}
${alerts}
END:VEVENT
END:VCALENDAR`;
            
            // تحميل ملف ICS
            const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `work-alarm-${Date.now()}.ics`;
            link.click();
            
            showMessage('✅ تم تحميل ملف التقويم. افتحه لإضافة المنبه للتقويم', 'success');
            
            // تنظيف
            setTimeout(() => URL.revokeObjectURL(url), 1000);
        }
        
        // تنسيق التاريخ لـ ICS
        function formatICS(date) {
            return date.toISOString().replace(/[-:]/g, '').replace(/\.\d{3}/, '');
        }
        
        // اختبار جميع الطرق
        function testAlarmMethods() {
            showMessage('🔧 اختبار جميع طرق المنبه...', 'info');
            
            const device = detectDevice();
            let testResults = `
                <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 10px; margin: 15px 0;">
                    <h4>🧪 نتائج الاختبار المفصلة:</h4>
                    <div style="text-align: right; line-height: 1.8;">
                        <h5>📱 معلومات الجهاز:</h5>
                        <ul>
                            <li><strong>نوع الجهاز:</strong> ${device.type}</li>
                            <li><strong>نظام التشغيل:</strong> ${device.os}</li>
                            <li><strong>المتصفح:</strong> ${device.browser}</li>
                            <li><strong>User Agent:</strong> <code style="font-size: 0.8em;">${navigator.userAgent}</code></li>
                        </ul>
                        
                        <h5>🔗 إمكانيات Deep Links:</h5>
                        <ul>
            `;
            
            // اختبار Deep Links
            testResults += `<li>📱 فتح تطبيقات المحمول: ${device.canUseDeepLinks ? '✅ مدعوم نظرياً' : '❌ غير مدعوم'}</li>`;
            
            // اختبار الطرق المختلفة
            if (device.type === 'Android') {
                const androidMethods = [
                    'Google Clock App',
                    'Samsung Clock App', 
                    'AOSP Clock App',
                    'Android Standard Intents',
                    'Android App Links'
                ];
                
                androidMethods.forEach(method => {
                    testResults += `<li>🤖 ${method}: سيتم اختباره</li>`;
                });
            } else if (device.type === 'iOS') {
                const iosMethods = [
                    'iOS Clock App',
                    'iOS Settings',
                    'iOS Shortcuts App'
                ];
                
                iosMethods.forEach(method => {
                    testResults += `<li>🍎 ${method}: سيتم اختباره</li>`;
                });
            }
            
            testResults += `</ul>
                        
                        <h5>🛠️ إمكانيات أخرى:</h5>
                        <ul>`;
            
            // اختبار Calendar
            testResults += `<li>📅 ملفات التقويم (ICS): ✅ مدعوم</li>`;
            
            // اختبار Notifications
            testResults += `<li>🔔 تنبيهات المتصفح: ${'Notification' in window ? '✅ مدعوم' : '❌ غير مدعوم'}</li>`;
            
            // اختبار Vibration
            testResults += `<li>📳 الاهتزاز: ${navigator.vibrate ? '✅ مدعوم' : '❌ غير مدعوم'}</li>`;
            
            // اختبار localStorage
            testResults += `<li>💾 التخزين المحلي: ${typeof(Storage) !== "undefined" ? '✅ مدعوم' : '❌ غير مدعوم'}</li>`;
            
            // اختبار Service Worker
            testResults += `<li>⚙️ Service Worker: ${'serviceWorker' in navigator ? '✅ مدعوم' : '❌ غير مدعوم'}</li>`;
            
            testResults += `</ul>
                    </div>
                </div>
                
                <div style="background: rgba(255,152,0,0.1); padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <h5>💡 نصائح الاستكشاف:</h5>
                    <ol style="text-align: right; line-height: 1.8;">
                        <li>إذا ظهر "Item not found"، جرب تطبيق ساعة مختلف</li>
                        <li>تأكد من تشغيل JavaScript في المتصفح</li>
                        <li>بعض المتصفحات تحجب Deep Links للأمان</li>
                        <li>استخدم "إضافة للتقويم" كبديل مضمون</li>
                        <li>تطبيقات المنبه المختلفة لها روابط مختلفة</li>
                    </ol>
                </div>`;
            
            document.getElementById('statusMessages').innerHTML = testResults;
            
            // اختبار تطبيقي للـ Deep Links
            if (device.canUseDeepLinks) {
                setTimeout(() => {
                    testActualDeepLinks(device);
                }, 2000);
            }
        }
        
        // اختبار تطبيقي للـ Deep Links
        function testActualDeepLinks(device) {
            showMessage('🔬 اختبار Deep Links تطبيقياً...', 'info');
            
            const testTitle = 'اختبار المنبه';
            const testTime = new Date();
            testTime.setMinutes(testTime.getMinutes() + 5);
            
            let testLinks = [];
            
            if (device.type === 'Android') {
                testLinks = [
                    {
                        name: 'Google Clock Standard',
                        url: `intent://alarm?hour=${testTime.getHours()}&minutes=${testTime.getMinutes()}&message=${encodeURIComponent(testTitle)}#Intent;scheme=android.intent.action.SET_ALARM;package=com.google.android.deskclock;end`
                    },
                    {
                        name: 'Samsung Clock',
                        url: `intent://alarm?hour=${testTime.getHours()}&minutes=${testTime.getMinutes()}&message=${encodeURIComponent(testTitle)}#Intent;scheme=android.intent.action.SET_ALARM;package=com.samsung.android.app.clockpackage;end`
                    },
                    {
                        name: 'Android Generic',
                        url: `intent:#Intent;action=android.intent.action.SET_ALARM;i.android.intent.extra.alarm.HOUR=${testTime.getHours()};i.android.intent.extra.alarm.MINUTES=${testTime.getMinutes()};S.android.intent.extra.alarm.MESSAGE=${testTitle};end`
                    }
                ];
            } else if (device.type === 'iOS') {
                testLinks = [
                    {
                        name: 'iOS Clock App',
                        url: `clock-alarm://new?at=${testTime.toISOString()}&label=${encodeURIComponent(testTitle)}`
                    },
                    {
                        name: 'iOS Clock Generic',
                        url: `clock://`
                    }
                ];
            }
            
            let testIndex = 0;
            
            function runNextTest() {
                if (testIndex >= testLinks.length) {
                    showMessage('✅ انتهى اختبار Deep Links. تحقق من النتائج أعلاه', 'info');
                    return;
                }
                
                const test = testLinks[testIndex];
                showMessage(`🔍 اختبار: ${test.name}`, 'info');
                
                // محاولة فتح الرابط
                const iframe = document.createElement('iframe');
                iframe.style.display = 'none';
                iframe.src = test.url;
                document.body.appendChild(iframe);
                
                let testResolved = false;
                
                // مراقب النجاح
                const successHandler = () => {
                    if (!testResolved && document.visibilityState === 'hidden') {
                        testResolved = true;
                        showMessage(`✅ ${test.name}: نجح!`, 'success');
                        document.removeEventListener('visibilitychange', successHandler);
                        if (iframe.parentNode) document.body.removeChild(iframe);
                    }
                };
                document.addEventListener('visibilitychange', successHandler);
                
                // مراقب الفشل
                setTimeout(() => {
                    if (!testResolved) {
                        testResolved = true;
                        showMessage(`❌ ${test.name}: لم ينجح`, 'error');
                        document.removeEventListener('visibilitychange', successHandler);
                        if (iframe.parentNode) document.body.removeChild(iframe);
                    }
                    
                    testIndex++;
                    setTimeout(runNextTest, 1000);
                }, 3000);
            }
            
            runNextTest();
        }
        
        // عرض رسالة حالة
        function showMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `status-message ${type}`;
            messageDiv.textContent = message;
            
            document.getElementById('statusMessages').appendChild(messageDiv);
            
            // إزالة الرسالة بعد 5 ثوان
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.remove();
                }
            }, 5000);
        }
        
        // تجربة روابط يدوية للاختبار
        function tryManualDeepLinks() {
            const device = detectDevice();
            
            if (device.type !== 'Android' && device.type !== 'iOS') {
                showMessage('هذه الوظيفة تعمل على أجهزة Android و iOS فقط', 'warning');
                return;
            }
            
            const manualLinks = `
                <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 10px; margin: 15px 0;">
                    <h4>🔗 روابط يدوية للاختبار:</h4>
                    <p style="margin-bottom: 15px;">اضغط على الروابط أدناه لاختبار أي منها يعمل على جهازك:</p>
                    
                    ${device.type === 'Android' ? getAndroidManualLinks() : getIOSManualLinks()}
                    
                    <div style="margin-top: 20px; padding: 15px; background: rgba(255,152,0,0.1); border-radius: 8px;">
                        <p><strong>💡 ملاحظة:</strong></p>
                        <ul style="text-align: right; line-height: 1.8;">
                            <li>إذا عمل أي رابط، أعلمني أي واحد نجح</li>
                            <li>إذا لم يعمل أي رابط، قد يكون المتصفح يحجبها</li>
                            <li>جرب فتح الصفحة في متصفح مختلف</li>
                            <li>تطبيق التقويم هو البديل الأضمن</li>
                        </ul>
                    </div>
                </div>
            `;
            
            document.getElementById('statusMessages').innerHTML = manualLinks;
        }
        
        function getAndroidManualLinks() {
            const testHour = 10;
            const testMinutes = 30;
            const testMessage = 'اختبار المنبه';
            
            return `
                <div style="text-align: right;">
                    <h5>🤖 روابط Android:</h5>
                    <div style="line-height: 2;">
                        <p><strong>1. Google Clock:</strong></p>
                        <a href="intent://alarm?hour=${testHour}&minutes=${testMinutes}&message=${encodeURIComponent(testMessage)}#Intent;scheme=android.intent.action.SET_ALARM;package=com.google.android.deskclock;end" 
                           style="color: #4CAF50; text-decoration: underline;">
                           Google Clock - الطريقة الأساسية
                        </a><br>
                        
                        <p><strong>2. Samsung Clock:</strong></p>
                        <a href="intent://alarm?hour=${testHour}&minutes=${testMinutes}&message=${encodeURIComponent(testMessage)}#Intent;scheme=android.intent.action.SET_ALARM;package=com.samsung.android.app.clockpackage;end" 
                           style="color: #4CAF50; text-decoration: underline;">
                           Samsung Clock App
                        </a><br>
                        
                        <p><strong>3. Android Standard:</strong></p>
                        <a href="intent:#Intent;action=android.intent.action.SET_ALARM;i.android.intent.extra.alarm.HOUR=${testHour};i.android.intent.extra.alarm.MINUTES=${testMinutes};S.android.intent.extra.alarm.MESSAGE=${testMessage};end" 
                           style="color: #4CAF50; text-decoration: underline;">
                           Android Generic Intent
                        </a><br>
                        
                        <p><strong>4. Alternative Format:</strong></p>
                        <a href="android-app://com.google.android.deskclock/alarm?hour=${testHour}&minutes=${testMinutes}&message=${encodeURIComponent(testMessage)}" 
                           style="color: #4CAF50; text-decoration: underline;">
                           Android App Link
                        </a><br>
                        
                        <p><strong>5. Simple Clock Open:</strong></p>
                        <a href="intent://alarm#Intent;scheme=clock;package=com.android.deskclock;end" 
                           style="color: #4CAF50; text-decoration: underline;">
                           فتح تطبيق الساعة فقط
                        </a>
                    </div>
                </div>
            `;
        }
        
        function getIOSManualLinks() {
            const testTime = new Date();
            testTime.setHours(10, 30, 0, 0);
            const testMessage = 'اختبار المنبه';
            
            return `
                <div style="text-align: right;">
                    <h5>🍎 روابط iOS:</h5>
                    <div style="line-height: 2;">
                        <p><strong>1. Clock Alarm:</strong></p>
                        <a href="clock-alarm://new?at=${testTime.toISOString()}&label=${encodeURIComponent(testMessage)}" 
                           style="color: #4CAF50; text-decoration: underline;">
                           iOS Clock Alarm
                        </a><br>
                        
                        <p><strong>2. Clock App:</strong></p>
                        <a href="clock://" 
                           style="color: #4CAF50; text-decoration: underline;">
                           فتح تطبيق Clock
                        </a><br>
                        
                        <p><strong>3. Settings:</strong></p>
                        <a href="prefs:root=SOUNDS&path=Ringtone" 
                           style="color: #4CAF50; text-decoration: underline;">
                           إعدادات الأصوات
                        </a><br>
                        
                        <p><strong>4. Shortcuts:</strong></p>
                        <a href="shortcuts://run-shortcut?name=CreateAlarm&input=${encodeURIComponent(testMessage)}" 
                           style="color: #4CAF50; text-decoration: underline;">
                           Shortcuts App
                        </a>
                    </div>
                </div>
            `;
        }
        
        // تهيئة الصفحة
        window.onload = function() {
            displayDeviceInfo();
            
            // تعيين التاريخ والوقت الحالي
            const now = new Date();
            const tomorrow = new Date(now.getTime() + 24 * 60 * 60 * 1000);
            
            document.getElementById('alarmTime').value = '07:00';
            document.getElementById('alarmDate').value = tomorrow.toISOString().slice(0, 10);
            
            // إضافة مستمعي الأحداث
            document.getElementById('alarmTitle').addEventListener('input', updateAlarmPreview);
            document.getElementById('alarmTime').addEventListener('input', updateAlarmPreview);
            document.getElementById('alarmDate').addEventListener('input', updateAlarmPreview);
            document.getElementById('alarmType').addEventListener('change', updateAlarmPreview);
            
            updateAlarmPreview();
        };
    </script>
</body>
</html>